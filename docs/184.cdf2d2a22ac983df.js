(self.webpackChunksmitd_game_poc=self.webpackChunksmitd_game_poc||[]).push([[184],{5184:(fe,S,d)=>{"use strict";d.r(S),d.d(S,{CatchyGameModule:()=>Mo});var p={};d.r(p),d.d(p,{fixNegotiationNeeded:()=>He,shimAddTrackRemoveTrack:()=>Fe,shimAddTrackRemoveTrackWithNative:()=>ze,shimGetDisplayMedia:()=>me,shimGetSendersWithDtmf:()=>Te,shimGetStats:()=>pe,shimGetUserMedia:()=>Ie,shimMediaStream:()=>we,shimOnTrack:()=>Be,shimPeerConnection:()=>je,shimSenderReceiverGetStats:()=>Ue});var C={};d.r(C),d.d(C,{shimGetDisplayMedia:()=>ot,shimGetUserMedia:()=>it,shimPeerConnection:()=>ee,shimReplaceTrack:()=>We});var x={};d.r(x),d.d(x,{shimAddTransceiver:()=>dr,shimCreateAnswer:()=>fr,shimCreateOffer:()=>hr,shimGetDisplayMedia:()=>qn,shimGetParameters:()=>pr,shimGetUserMedia:()=>st,shimOnTrack:()=>sr,shimPeerConnection:()=>Et,shimRTCDataChannel:()=>ur,shimReceiverGetStats:()=>cr,shimRemoveStream:()=>lr,shimSenderGetStats:()=>ar});var P={};d.r(P),d.d(P,{shimAudioContext:()=>Tr,shimCallbacksAPI:()=>yr,shimConstraints:()=>_r,shimCreateOfferLegacy:()=>Sr,shimGetUserMedia:()=>vr,shimLocalStreamsAPI:()=>mr,shimRTCIceServerUrls:()=>Cr,shimRemoteStreamsAPI:()=>gr,shimTrackEventTransceiver:()=>br});var F={};d.r(F),d.d(F,{removeExtmapAllowMixed:()=>Pt,shimAddIceCandidateNullOrEmpty:()=>lt,shimConnectionState:()=>xt,shimMaxMessageSize:()=>Ye,shimRTCIceCandidate:()=>ct,shimSendThrowTypeError:()=>Je});var q=d(9808),X=d(1589),f=d(5861),g=d(7013),v=d(6682),w=d(4237),j=d.n(w),H=d(1509),k=d(5096),z=d(9018),L=d(321),h=d(9263),m=d(3386),b=d(4938),s=d(5e3),E=d(967),B=d(4214),R=d(8819);let N=!0,W=!0;function O(t,r,e){const n=t.match(r);return n&&n.length>=e&&parseInt(n[e],10)}function I(t,r,e){if(!t.RTCPeerConnection)return;const n=t.RTCPeerConnection.prototype,i=n.addEventListener;n.addEventListener=function(c,a){if(c!==r)return i.apply(this,arguments);const l=u=>{const y=e(u);y&&(a.handleEvent?a.handleEvent(y):a(y))};return this._eventMap=this._eventMap||{},this._eventMap[r]||(this._eventMap[r]=new Map),this._eventMap[r].set(a,l),i.apply(this,[c,l])};const o=n.removeEventListener;n.removeEventListener=function(c,a){if(c!==r||!this._eventMap||!this._eventMap[r])return o.apply(this,arguments);if(!this._eventMap[r].has(a))return o.apply(this,arguments);const l=this._eventMap[r].get(a);return this._eventMap[r].delete(a),0===this._eventMap[r].size&&delete this._eventMap[r],0===Object.keys(this._eventMap).length&&delete this._eventMap,o.apply(this,[c,l])},Object.defineProperty(n,"on"+r,{get(){return this["_on"+r]},set(c){this["_on"+r]&&(this.removeEventListener(r,this["_on"+r]),delete this["_on"+r]),c&&this.addEventListener(r,this["_on"+r]=c)},enumerable:!0,configurable:!0})}function ne(t){return"boolean"!=typeof t?new Error("Argument type: "+typeof t+". Please use a boolean."):(N=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function Y(t){return"boolean"!=typeof t?new Error("Argument type: "+typeof t+". Please use a boolean."):(W=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function $(){if("object"==typeof window){if(N)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function Q(t,r){!W||console.warn(t+" is deprecated, please use "+r+" instead.")}function K(t){return"[object Object]"===Object.prototype.toString.call(t)}function Ne(t){return K(t)?Object.keys(t).reduce(function(r,e){const n=K(t[e]),i=n?Ne(t[e]):t[e],o=n&&!Object.keys(i).length;return void 0===i||o?r:Object.assign(r,{[e]:i})},{}):t}function G(t,r,e){!r||e.has(r.id)||(e.set(r.id,r),Object.keys(r).forEach(n=>{n.endsWith("Id")?G(t,t.get(r[n]),e):n.endsWith("Ids")&&r[n].forEach(i=>{G(t,t.get(i),e)})}))}function Le(t,r,e){const n=e?"outbound-rtp":"inbound-rtp",i=new Map;if(null===r)return i;const o=[];return t.forEach(c=>{"track"===c.type&&c.trackIdentifier===r.id&&o.push(c)}),o.forEach(c=>{t.forEach(a=>{a.type===n&&a.trackId===c.id&&G(t,a,i)})}),i}const Se=$;function Ie(t,r){const e=t&&t.navigator;if(!e.mediaDevices)return;const n=function(a){if("object"!=typeof a||a.mandatory||a.optional)return a;const l={};return Object.keys(a).forEach(u=>{if("require"===u||"advanced"===u||"mediaSource"===u)return;const y="object"==typeof a[u]?a[u]:{ideal:a[u]};void 0!==y.exact&&"number"==typeof y.exact&&(y.min=y.max=y.exact);const _=function(T,A){return T?T+A.charAt(0).toUpperCase()+A.slice(1):"deviceId"===A?"sourceId":A};if(void 0!==y.ideal){l.optional=l.optional||[];let T={};"number"==typeof y.ideal?(T[_("min",u)]=y.ideal,l.optional.push(T),T={},T[_("max",u)]=y.ideal,l.optional.push(T)):(T[_("",u)]=y.ideal,l.optional.push(T))}void 0!==y.exact&&"number"!=typeof y.exact?(l.mandatory=l.mandatory||{},l.mandatory[_("",u)]=y.exact):["min","max"].forEach(T=>{void 0!==y[T]&&(l.mandatory=l.mandatory||{},l.mandatory[_(T,u)]=y[T])})}),a.advanced&&(l.optional=(l.optional||[]).concat(a.advanced)),l},i=function(a,l){if(r.version>=61)return l(a);if((a=JSON.parse(JSON.stringify(a)))&&"object"==typeof a.audio){const u=function(y,_,T){_ in y&&!(T in y)&&(y[T]=y[_],delete y[_])};u((a=JSON.parse(JSON.stringify(a))).audio,"autoGainControl","googAutoGainControl"),u(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=n(a.audio)}if(a&&"object"==typeof a.video){let u=a.video.facingMode;u=u&&("object"==typeof u?u:{ideal:u});const y=r.version<66;if(u&&("user"===u.exact||"environment"===u.exact||"user"===u.ideal||"environment"===u.ideal)&&(!e.mediaDevices.getSupportedConstraints||!e.mediaDevices.getSupportedConstraints().facingMode||y)){let _;if(delete a.video.facingMode,"environment"===u.exact||"environment"===u.ideal?_=["back","rear"]:("user"===u.exact||"user"===u.ideal)&&(_=["front"]),_)return e.mediaDevices.enumerateDevices().then(T=>{let A=(T=T.filter(D=>"videoinput"===D.kind)).find(D=>_.some(V=>D.label.toLowerCase().includes(V)));return!A&&T.length&&_.includes("back")&&(A=T[T.length-1]),A&&(a.video.deviceId=u.exact?{exact:A.deviceId}:{ideal:A.deviceId}),a.video=n(a.video),Se("chrome: "+JSON.stringify(a)),l(a)})}a.video=n(a.video)}return Se("chrome: "+JSON.stringify(a)),l(a)},o=function(a){return r.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(e.getUserMedia=function(a,l,u){i(a,y=>{e.webkitGetUserMedia(y,l,_=>{u&&u(o(_))})})}.bind(e),e.mediaDevices.getUserMedia){const a=e.mediaDevices.getUserMedia.bind(e.mediaDevices);e.mediaDevices.getUserMedia=function(l){return i(l,u=>a(u).then(y=>{if(u.audio&&!y.getAudioTracks().length||u.video&&!y.getVideoTracks().length)throw y.getTracks().forEach(_=>{_.stop()}),new DOMException("","NotFoundError");return y},y=>Promise.reject(o(y))))}}}function me(t,r){if((!t.navigator.mediaDevices||!("getDisplayMedia"in t.navigator.mediaDevices))&&t.navigator.mediaDevices){if("function"!=typeof r)return void console.error("shimGetDisplayMedia: getSourceId argument is not a function");t.navigator.mediaDevices.getDisplayMedia=function(n){return r(n).then(i=>{const o=n.video&&n.video.width,c=n.video&&n.video.height;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:n.video&&n.video.frameRate||3}},o&&(n.video.mandatory.maxWidth=o),c&&(n.video.mandatory.maxHeight=c),t.navigator.mediaDevices.getUserMedia(n)})}}}function we(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function Be(t){if("object"==typeof t&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",i=>{let o;o=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(a=>a.track&&a.track.id===i.track.id):{track:i.track};const c=new Event("track");c.track=i.track,c.receiver=o,c.transceiver={receiver:o},c.streams=[n.stream],this.dispatchEvent(c)}),n.stream.getTracks().forEach(i=>{let o;o=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(a=>a.track&&a.track.id===i.id):{track:i};const c=new Event("track");c.track=i,c.receiver=o,c.transceiver={receiver:o},c.streams=[n.stream],this.dispatchEvent(c)})},this.addEventListener("addstream",this._ontrackpoly)),r.apply(this,arguments)}}else I(t,"track",r=>(r.transceiver||Object.defineProperty(r,"transceiver",{value:{receiver:r.receiver}}),r))}function Te(t){if("object"==typeof t&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const r=function(i,o){return{track:o,get dtmf(){return void 0===this._dtmf&&(this._dtmf="audio"===o.kind?i.createDTMFSender(o):null),this._dtmf},_pc:i}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,l){let u=i.apply(this,arguments);return u||(u=r(this,a),this._senders.push(u)),u};const o=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){o.apply(this,arguments);const l=this._senders.indexOf(a);-1!==l&&this._senders.splice(l,1)}}const e=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._senders=this._senders||[],e.apply(this,[o]),o.getTracks().forEach(c=>{this._senders.push(r(this,c))})};const n=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){this._senders=this._senders||[],n.apply(this,[o]),o.getTracks().forEach(c=>{const a=this._senders.find(l=>l.track===c);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if("object"==typeof t&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const r=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const n=r.apply(this,[]);return n.forEach(i=>i._pc=this),n},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&(this._dtmf="audio"===this.track.kind?this._pc.createDTMFSender(this.track):null),this._dtmf}})}}function pe(t){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[n,i,o]=arguments;if(arguments.length>0&&"function"==typeof n)return r.apply(this,arguments);if(0===r.length&&(0===arguments.length||"function"!=typeof n))return r.apply(this,[]);const c=function(l){const u={};return l.result().forEach(_=>{const T={id:_.id,timestamp:_.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[_.type]||_.type};_.names().forEach(A=>{T[A]=_.stat(A)}),u[T.id]=T}),u},a=function(l){return new Map(Object.keys(l).map(u=>[u,l[u]]))};return arguments.length>=2?r.apply(this,[function(u){i(a(c(u)))},n]):new Promise((l,u)=>{r.apply(this,[function(y){l(a(c(y)))},u])}).then(i,o)}}function Ue(t){if(!("object"==typeof t&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const o=e.apply(this,[]);return o.forEach(c=>c._pc=this),o});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const o=n.apply(this,arguments);return o._pc=this,o}),t.RTCRtpSender.prototype.getStats=function(){const o=this;return this._pc.getStats().then(c=>Le(c,o.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(o=>o._pc=this),i}),I(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(o=>Le(o,i.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const n=arguments[0];let i,o,c;return this.getSenders().forEach(a=>{a.track===n&&(i?c=!0:i=a)}),this.getReceivers().forEach(a=>(a.track===n&&(o?c=!0:o=a),a.track===n)),c||i&&o?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():o?o.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return r.apply(this,arguments)}}function ze(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(c=>this._shimmedLocalStreams[c][0])};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(c,a){if(!a)return r.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=r.apply(this,arguments);return this._shimmedLocalStreams[a.id]?-1===this._shimmedLocalStreams[a.id].indexOf(l)&&this._shimmedLocalStreams[a.id].push(l):this._shimmedLocalStreams[a.id]=[a,l],l};const e=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(c){this._shimmedLocalStreams=this._shimmedLocalStreams||{},c.getTracks().forEach(u=>{if(this.getSenders().find(_=>_.track===u))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();e.apply(this,arguments);const l=this.getSenders().filter(u=>-1===a.indexOf(u));this._shimmedLocalStreams[c.id]=[c].concat(l)};const n=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(c){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[c.id],n.apply(this,arguments)};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(c){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},c&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const l=this._shimmedLocalStreams[a].indexOf(c);-1!==l&&this._shimmedLocalStreams[a].splice(l,1),1===this._shimmedLocalStreams[a].length&&delete this._shimmedLocalStreams[a]}),i.apply(this,arguments)}}function Fe(t,r){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&r.version>=65)return ze(t);const e=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const y=e.apply(this);return this._reverseStreams=this._reverseStreams||{},y.map(_=>this._reverseStreams[_.id])};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(y){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},y.getTracks().forEach(_=>{if(this.getSenders().find(A=>A.track===_))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[y.id]){const _=new t.MediaStream(y.getTracks());this._streams[y.id]=_,this._reverseStreams[_.id]=y,y=_}n.apply(this,[y])};const i=t.RTCPeerConnection.prototype.removeStream;function o(u,y){let _=y.sdp;return Object.keys(u._reverseStreams||[]).forEach(T=>{const A=u._reverseStreams[T];_=_.replace(new RegExp(u._streams[A.id].id,"g"),A.id)}),new RTCSessionDescription({type:y.type,sdp:_})}function c(u,y){let _=y.sdp;return Object.keys(u._reverseStreams||[]).forEach(T=>{const A=u._reverseStreams[T],D=u._streams[A.id];_=_.replace(new RegExp(A.id,"g"),D.id)}),new RTCSessionDescription({type:y.type,sdp:_})}t.RTCPeerConnection.prototype.removeStream=function(y){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[y.id]||y]),delete this._reverseStreams[this._streams[y.id]?this._streams[y.id].id:y.id],delete this._streams[y.id]},t.RTCPeerConnection.prototype.addTrack=function(y,_){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const T=[].slice.call(arguments,1);if(1!==T.length||!T[0].getTracks().find(V=>V===y))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(V=>V.track===y))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const D=this._streams[_.id];if(D)D.addTrack(y),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const V=new t.MediaStream([y]);this._streams[_.id]=V,this._reverseStreams[V.id]=_,this.addStream(V)}return this.getSenders().find(V=>V.track===y)},["createOffer","createAnswer"].forEach(function(u){const y=t.RTCPeerConnection.prototype[u],_={[u](){const T=arguments;return arguments.length&&"function"==typeof arguments[0]?y.apply(this,[D=>{const V=o(this,D);T[0].apply(null,[V])},D=>{T[1]&&T[1].apply(null,D)},arguments[2]]):y.apply(this,arguments).then(D=>o(this,D))}};t.RTCPeerConnection.prototype[u]=_[u]});const a=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=c(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};const l=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const u=l.get.apply(this);return""===u.type?u:o(this,u)}}),t.RTCPeerConnection.prototype.removeTrack=function(y){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!y._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(y._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let T;this._streams=this._streams||{},Object.keys(this._streams).forEach(A=>{this._streams[A].getTracks().find(V=>y.track===V)&&(T=this._streams[A])}),T&&(1===T.getTracks().length?this.removeStream(this._reverseStreams[T.id]):T.removeTrack(y.track),this.dispatchEvent(new Event("negotiationneeded")))}}function je(t,r){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){const n=t.RTCPeerConnection.prototype[e],i={[e](){return arguments[0]=new("addIceCandidate"===e?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};t.RTCPeerConnection.prototype[e]=i[e]})}function He(t,r){I(t,"negotiationneeded",e=>{const n=e.target;if(!(r.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e})}var $e=d(6334),Ee=d.n($e);function it(t){const r=t&&t.navigator,n=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(i){return n(i).catch(o=>Promise.reject(function(i){return{name:{PermissionDeniedError:"NotAllowedError"}[i.name]||i.name,message:i.message,constraint:i.constraint,toString(){return this.name}}}(o)))}}function ot(t){"getDisplayMedia"in t.navigator&&(!t.navigator.mediaDevices||t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||(t.navigator.mediaDevices.getDisplayMedia=t.navigator.getDisplayMedia.bind(t.navigator)))}function ee(t,r){if(t.RTCIceGatherer&&(t.RTCIceCandidate||(t.RTCIceCandidate=function(i){return i}),t.RTCSessionDescription||(t.RTCSessionDescription=function(i){return i}),r.version<15025)){const n=Object.getOwnPropertyDescriptor(t.MediaStreamTrack.prototype,"enabled");Object.defineProperty(t.MediaStreamTrack.prototype,"enabled",{set(i){n.set.call(this,i);const o=new Event("enabled");o.enabled=i,this.dispatchEvent(o)}})}t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)&&Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new t.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),t.RTCDtmfSender&&!t.RTCDTMFSender&&(t.RTCDTMFSender=t.RTCDtmfSender);const e=Ee()(t,r.version);t.RTCPeerConnection=function(i){return i&&i.iceServers&&(i.iceServers=function ke(t,r){let e=!1;return(t=JSON.parse(JSON.stringify(t))).filter(n=>{if(n&&(n.urls||n.url)){let i=n.urls||n.url;n.url&&!n.urls&&Q("RTCIceServer.url","RTCIceServer.urls");const o="string"==typeof i;return o&&(i=[i]),i=i.filter(c=>{if(0===c.indexOf("stun:"))return!1;const a=c.startsWith("turn")&&!c.startsWith("turn:[")&&c.includes("transport=udp");return a&&!e?(e=!0,!0):a&&!e}),delete n.url,n.urls=o?i[0]:i,!!i.length}})}(i.iceServers),$("ICE servers after filtering:",i.iceServers)),new e(i)},t.RTCPeerConnection.prototype=e.prototype}function We(t){t.RTCRtpSender&&!("replaceTrack"in t.RTCRtpSender.prototype)&&(t.RTCRtpSender.prototype.replaceTrack=t.RTCRtpSender.prototype.setTrack)}function st(t,r){const e=t&&t.navigator,n=t&&t.MediaStreamTrack;if(e.getUserMedia=function(i,o,c){Q("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),e.mediaDevices.getUserMedia(i).then(o,c)},!(r.version>55&&"autoGainControl"in e.mediaDevices.getSupportedConstraints())){const i=function(c,a,l){a in c&&!(l in c)&&(c[l]=c[a],delete c[a])},o=e.mediaDevices.getUserMedia.bind(e.mediaDevices);if(e.mediaDevices.getUserMedia=function(c){return"object"==typeof c&&"object"==typeof c.audio&&(c=JSON.parse(JSON.stringify(c)),i(c.audio,"autoGainControl","mozAutoGainControl"),i(c.audio,"noiseSuppression","mozNoiseSuppression")),o(c)},n&&n.prototype.getSettings){const c=n.prototype.getSettings;n.prototype.getSettings=function(){const a=c.apply(this,arguments);return i(a,"mozAutoGainControl","autoGainControl"),i(a,"mozNoiseSuppression","noiseSuppression"),a}}if(n&&n.prototype.applyConstraints){const c=n.prototype.applyConstraints;n.prototype.applyConstraints=function(a){return"audio"===this.kind&&"object"==typeof a&&(a=JSON.parse(JSON.stringify(a)),i(a,"autoGainControl","mozAutoGainControl"),i(a,"noiseSuppression","mozNoiseSuppression")),c.apply(this,[a])}}}}function qn(t,r){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||!t.navigator.mediaDevices||(t.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return!0===n.video?n.video={mediaSource:r}:n.video.mediaSource=r,t.navigator.mediaDevices.getUserMedia(n)})}function sr(t){"object"==typeof t&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Et(t,r){if("object"!=typeof t||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const o=t.RTCPeerConnection.prototype[i],c={[i](){return arguments[0]=new("addIceCandidate"===i?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};t.RTCPeerConnection.prototype[i]=c[i]});const e={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[o,c,a]=arguments;return n.apply(this,[o||null]).then(l=>{if(r.version<53&&!c)try{l.forEach(u=>{u.type=e[u.type]||u.type})}catch(u){if("TypeError"!==u.name)throw u;l.forEach((y,_)=>{l.set(_,Object.assign({},y,{type:e[y.type]||y.type}))})}return l}).then(c,a)}}function ar(t){if("object"!=typeof t||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const r=t.RTCPeerConnection.prototype.getSenders;r&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=r.apply(this,[]);return i.forEach(o=>o._pc=this),i});const e=t.RTCPeerConnection.prototype.addTrack;e&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=e.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function cr(t){if("object"!=typeof t||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const r=t.RTCPeerConnection.prototype.getReceivers;r&&(t.RTCPeerConnection.prototype.getReceivers=function(){const n=r.apply(this,[]);return n.forEach(i=>i._pc=this),n}),I(t,"track",e=>(e.receiver._pc=e.srcElement,e)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function lr(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(e){Q("removeStream","removeTrack"),this.getSenders().forEach(n=>{n.track&&e.getTracks().includes(n.track)&&this.removeTrack(n)})})}function ur(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function dr(t){if("object"!=typeof t||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.addTransceiver;r&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const n=arguments[1],i=n&&"sendEncodings"in n;i&&n.sendEncodings.forEach(c=>{if("rid"in c&&!/^[a-z0-9]{0,16}$/i.test(c.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in c&&!(parseFloat(c.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in c&&!(parseFloat(c.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const o=r.apply(this,arguments);if(i){const{sender:c}=o,a=c.getParameters();(!("encodings"in a)||1===a.encodings.length&&0===Object.keys(a.encodings[0]).length)&&(a.encodings=n.sendEncodings,c.sendEncodings=n.sendEncodings,this.setParametersPromises.push(c.setParameters(a).then(()=>{delete c.sendEncodings}).catch(()=>{delete c.sendEncodings})))}return o})}function pr(t){if("object"!=typeof t||!t.RTCRtpSender)return;const r=t.RTCRtpSender.prototype.getParameters;r&&(t.RTCRtpSender.prototype.getParameters=function(){const n=r.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function hr(t){if("object"!=typeof t||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}function fr(t){if("object"!=typeof t||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}function mr(t){if("object"==typeof t&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(n){this._localStreams||(this._localStreams=[]),this._localStreams.includes(n)||this._localStreams.push(n),n.getAudioTracks().forEach(i=>r.call(this,i,n)),n.getVideoTracks().forEach(i=>r.call(this,i,n))},t.RTCPeerConnection.prototype.addTrack=function(n,...i){return i&&i.forEach(o=>{this._localStreams?this._localStreams.includes(o)||this._localStreams.push(o):this._localStreams=[o]}),r.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(e);if(-1===n)return;this._localStreams.splice(n,1);const i=e.getTracks();this.getSenders().forEach(o=>{i.includes(o.track)&&this.removeTrack(o)})})}}function gr(t){if("object"==typeof t&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=n=>{n.streams.forEach(i=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(i))return;this._remoteStreams.push(i);const o=new Event("addstream");o.stream=i,this.dispatchEvent(o)})})}});const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(o=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(o)>=0)return;n._remoteStreams.push(o);const c=new Event("addstream");c.stream=o,n.dispatchEvent(c)})}),r.apply(n,arguments)}}}function yr(t){if("object"!=typeof t||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,e=r.createOffer,n=r.createAnswer,i=r.setLocalDescription,o=r.setRemoteDescription,c=r.addIceCandidate;r.createOffer=function(u,y){const _=arguments.length>=2?arguments[2]:arguments[0],T=e.apply(this,[_]);return y?(T.then(u,y),Promise.resolve()):T},r.createAnswer=function(u,y){const _=arguments.length>=2?arguments[2]:arguments[0],T=n.apply(this,[_]);return y?(T.then(u,y),Promise.resolve()):T};let a=function(l,u,y){const _=i.apply(this,[l]);return y?(_.then(u,y),Promise.resolve()):_};r.setLocalDescription=a,a=function(l,u,y){const _=o.apply(this,[l]);return y?(_.then(u,y),Promise.resolve()):_},r.setRemoteDescription=a,a=function(l,u,y){const _=c.apply(this,[l]);return y?(_.then(u,y),Promise.resolve()):_},r.addIceCandidate=a}function vr(t){const r=t&&t.navigator;if(r.mediaDevices&&r.mediaDevices.getUserMedia){const e=r.mediaDevices,n=e.getUserMedia.bind(e);r.mediaDevices.getUserMedia=i=>n(_r(i))}!r.getUserMedia&&r.mediaDevices&&r.mediaDevices.getUserMedia&&(r.getUserMedia=function(n,i,o){r.mediaDevices.getUserMedia(n).then(i,o)}.bind(r))}function _r(t){return t&&void 0!==t.video?Object.assign({},t,{video:Ne(t.video)}):t}function Cr(t){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection;t.RTCPeerConnection=function(n,i){if(n&&n.iceServers){const o=[];for(let c=0;c<n.iceServers.length;c++){let a=n.iceServers[c];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(Q("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,o.push(a)):o.push(n.iceServers[c])}n.iceServers=o}return new r(n,i)},t.RTCPeerConnection.prototype=r.prototype,"generateCertificate"in r&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:()=>r.generateCertificate})}function br(t){"object"==typeof t&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Sr(t){const r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(n){if(n){void 0!==n.offerToReceiveAudio&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const i=this.getTransceivers().find(c=>"audio"===c.receiver.track.kind);!1===n.offerToReceiveAudio&&i?"sendrecv"===i.direction?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":"recvonly"===i.direction&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):!0===n.offerToReceiveAudio&&!i&&this.addTransceiver("audio"),void 0!==n.offerToReceiveVideo&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const o=this.getTransceivers().find(c=>"video"===c.receiver.track.kind);!1===n.offerToReceiveVideo&&o?"sendrecv"===o.direction?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":"recvonly"===o.direction&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):!0===n.offerToReceiveVideo&&!o&&this.addTransceiver("video")}return r.apply(this,arguments)}}function Tr(t){"object"!=typeof t||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var Zn=d(7463),at=d.n(Zn);function ct(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const r=t.RTCIceCandidate;t.RTCIceCandidate=function(n){if("object"==typeof n&&n.candidate&&0===n.candidate.indexOf("a=")&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const i=new r(n),o=at().parseCandidate(n.candidate),c=Object.assign(i,o);return c.toJSON=function(){return{candidate:c.candidate,sdpMid:c.sdpMid,sdpMLineIndex:c.sdpMLineIndex,usernameFragment:c.usernameFragment}},c}return new r(n)},t.RTCIceCandidate.prototype=r.prototype,I(t,"icecandidate",e=>(e.candidate&&Object.defineProperty(e,"candidate",{value:new t.RTCIceCandidate(e.candidate),writable:"false"}),e))}function Ye(t,r){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const e=function(a){if(!a||!a.sdp)return!1;const l=at().splitSections(a.sdp);return l.shift(),l.some(u=>{const y=at().parseMLine(u);return y&&"application"===y.kind&&-1!==y.protocol.indexOf("SCTP")})},n=function(a){const l=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===l||l.length<2)return-1;const u=parseInt(l[1],10);return u!=u?-1:u},i=function(a){let l=65536;return"firefox"===r.browser&&(l=r.version<57?-1===a?16384:2147483637:r.version<60?57===r.version?65535:65536:2147483637),l},o=function(a,l){let u=65536;"firefox"===r.browser&&57===r.version&&(u=65535);const y=at().matchPrefix(a.sdp,"a=max-message-size:");return y.length>0?u=parseInt(y[0].substr(19),10):"firefox"===r.browser&&-1!==l&&(u=2147483637),u},c=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===r.browser&&r.version>=76){const{sdpSemantics:l}=this.getConfiguration();"plan-b"===l&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(e(arguments[0])){const l=n(arguments[0]),u=i(l),y=o(arguments[0],l);let _;_=0===u&&0===y?Number.POSITIVE_INFINITY:0===u||0===y?Math.max(u,y):Math.min(u,y);const T={};Object.defineProperty(T,"maxMessageSize",{get:()=>_}),this._sctp=T}return c.apply(this,arguments)}}function Je(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function r(n,i){const o=n.send;n.send=function(){const a=arguments[0],l=a.length||a.size||a.byteLength;if("open"===n.readyState&&i.sctp&&l>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return o.apply(n,arguments)}}const e=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const i=e.apply(this,arguments);return r(i,this),i},I(t,"datachannel",n=>(r(n.channel,n.target),n))}function xt(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const r=t.RTCPeerConnection.prototype;Object.defineProperty(r,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{const n=r[e];r[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const o=i.target;if(o._lastConnectionState!==o.connectionState){o._lastConnectionState=o.connectionState;const c=new Event("connectionstatechange",i);o.dispatchEvent(c)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}function Pt(t,r){if(!t.RTCPeerConnection||"chrome"===r.browser&&r.version>=71||"safari"===r.browser&&r.version>=605)return;const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&-1!==i.sdp.indexOf("\na=extmap-allow-mixed")){const o=i.sdp.split("\n").filter(c=>"a=extmap-allow-mixed"!==c.trim()).join("\n");t.RTCSessionDescription&&i instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:i.type,sdp:o}):i.sdp=o}return e.apply(this,arguments)}}function lt(t,r){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype.addIceCandidate;!e||0===e.length||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===r.browser&&r.version<78||"firefox"===r.browser&&r.version<68||"safari"===r.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}const kr=function Kn({window:t}={},r={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const e=$,n=function ie(t){const r={browser:null,version:null};if(void 0===t||!t.navigator)return r.browser="Not a browser.",r;const{navigator:e}=t;if(e.mozGetUserMedia)r.browser="firefox",r.version=O(e.userAgent,/Firefox\/(\d+)\./,1);else if(e.webkitGetUserMedia||!1===t.isSecureContext&&t.webkitRTCPeerConnection&&!t.RTCIceGatherer)r.browser="chrome",r.version=O(e.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(e.mediaDevices&&e.userAgent.match(/Edge\/(\d+).(\d+)$/))r.browser="edge",r.version=O(e.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!t.RTCPeerConnection||!e.userAgent.match(/AppleWebKit\/(\d+)\./))return r.browser="Not a supported browser.",r;r.browser="safari",r.version=O(e.userAgent,/AppleWebKit\/(\d+)\./,1),r.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype}return r}(t),i={browserDetails:n,commonShim:F,extractVersion:O,disableLog:ne,disableWarnings:Y};switch(n.browser){case"chrome":if(!p||!je||!r.shimChrome)return e("Chrome shim is not included in this adapter release."),i;if(null===n.version)return e("Chrome shim can not determine version, not shimming."),i;e("adapter.js shimming chrome."),i.browserShim=p,lt(t,n),Ie(t,n),we(t),je(t,n),Be(t),Fe(t,n),Te(t),pe(t),Ue(t),He(t,n),ct(t),xt(t),Ye(t,n),Je(t),Pt(t,n);break;case"firefox":if(!x||!Et||!r.shimFirefox)return e("Firefox shim is not included in this adapter release."),i;e("adapter.js shimming firefox."),i.browserShim=x,lt(t,n),st(t,n),Et(t,n),sr(t),lr(t),ar(t),cr(t),ur(t),dr(t),pr(t),hr(t),fr(t),ct(t),xt(t),Ye(t,n),Je(t);break;case"edge":if(!C||!ee||!r.shimEdge)return e("MS edge shim is not included in this adapter release."),i;e("adapter.js shimming edge."),i.browserShim=C,it(t),ot(t),ee(t,n),We(t),Ye(t,n),Je(t);break;case"safari":if(!P||!r.shimSafari)return e("Safari shim is not included in this adapter release."),i;e("adapter.js shimming safari."),i.browserShim=P,lt(t,n),Cr(t),Sr(t),yr(t),mr(t),gr(t),br(t),vr(t),Tr(t),ct(t),Ye(t,n),Je(t),Pt(t,n);break;default:e("Unsupported browser!")}return i}({window:"undefined"==typeof window?void 0:window});function ge(t,r,e,n){Object.defineProperty(t,r,{get:e,set:n,enumerable:!0,configurable:!0})}var Rt=kr.default||kr,qe=new(function(){function t(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}return t.prototype.isWebRTCSupported=function(){return"undefined"!=typeof RTCPeerConnection},t.prototype.isBrowserSupported=function(){var r=this.getBrowser(),e=this.getVersion();return!!this.supportedBrowsers.includes(r)&&("chrome"===r?e>=this.minChromeVersion:"firefox"===r?e>=this.minFirefoxVersion:"safari"===r&&!this.isIOS&&e>=this.minSafariVersion)},t.prototype.getBrowser=function(){return Rt.browserDetails.browser},t.prototype.getVersion=function(){return Rt.browserDetails.version||0},t.prototype.isUnifiedPlanSupported=function(){var r=this.getBrowser(),e=Rt.browserDetails.version||0;if("chrome"===r&&e<this.minChromeVersion)return!1;if("firefox"===r&&e>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var n,i=!1;try{(n=new RTCPeerConnection).addTransceiver("audio"),i=!0}catch(o){}finally{n&&n.close()}return i},t.prototype.toString=function(){return"Supports:\n    browser:".concat(this.getBrowser(),"\n    version:").concat(this.getVersion(),"\n    isIOS:").concat(this.isIOS,"\n    isWebRTCSupported:").concat(this.isWebRTCSupported(),"\n    isBrowserSupported:").concat(this.isBrowserSupported(),"\n    isUnifiedPlanSupported:").concat(this.isUnifiedPlanSupported())},t}()),Er={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"},Xn=function(){function t(){this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.chunkedMTU=16300,this.defaultConfig=Er,this.browser=qe.getBrowser(),this.browserVersion=qe.getVersion(),this.supports=function(){var e,r={browser:qe.isBrowserSupported(),webRTC:qe.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!r.webRTC)return r;try{e=new RTCPeerConnection(Er),r.audioVideo=!0;var n=void 0;try{n=e.createDataChannel("_PEERJSTEST",{ordered:!0}),r.data=!0,r.reliable=!!n.ordered;try{n.binaryType="blob",r.binaryBlob=!qe.isIOS}catch(i){}}catch(i){}finally{n&&n.close()}}catch(i){}finally{e&&e.close()}return r}(),this.pack=R.pack,this.unpack=R.unpack,this._dataCount=1}return t.prototype.noop=function(){},t.prototype.validateId=function(r){return!r||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(r)},t.prototype.chunk=function(r){for(var e=[],n=r.size,i=Math.ceil(n/U.chunkedMTU),o=0,c=0;c<n;){var a=Math.min(n,c+U.chunkedMTU),l=r.slice(c,a);e.push({__peerData:this._dataCount,n:o,data:l,total:i}),c=a,o++}return this._dataCount++,e},t.prototype.blobToArrayBuffer=function(r,e){var n=new FileReader;return n.onload=function(i){i.target&&e(i.target.result)},n.readAsArrayBuffer(r),n},t.prototype.binaryStringToArrayBuffer=function(r){for(var e=new Uint8Array(r.length),n=0;n<r.length;n++)e[n]=255&r.charCodeAt(n);return e.buffer},t.prototype.randomToken=function(){return Math.random().toString(36).slice(2)},t.prototype.isSecure=function(){return"https:"===location.protocol},t}(),U=new Xn;ge({},"Peer",()=>It,t=>It=t);var Ze,Qn=Object.prototype.hasOwnProperty,ce="~";function Ke(){}function ei(t,r,e){this.fn=t,this.context=r,this.once=e||!1}function Pr(t,r,e,n,i){if("function"!=typeof e)throw new TypeError("The listener must be a function");var o=new ei(e,n||t,i),c=ce?ce+r:r;return t._events[c]?t._events[c].fn?t._events[c]=[t._events[c],o]:t._events[c].push(o):(t._events[c]=o,t._eventsCount++),t}function ut(t,r){0==--t._eventsCount?t._events=new Ke:delete t._events[r]}function oe(){this._events=new Ke,this._eventsCount=0}Object.create&&(Ke.prototype=Object.create(null),(new Ke).__proto__||(ce=!1)),oe.prototype.eventNames=function(){var e,n,r=[];if(0===this._eventsCount)return r;for(n in e=this._events)Qn.call(e,n)&&r.push(ce?n.slice(1):n);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},oe.prototype.listeners=function(r){var n=this._events[ce?ce+r:r];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,o=n.length,c=new Array(o);i<o;i++)c[i]=n[i].fn;return c},oe.prototype.listenerCount=function(r){var n=this._events[ce?ce+r:r];return n?n.fn?1:n.length:0},oe.prototype.emit=function(r,e,n,i,o,c){var a=ce?ce+r:r;if(!this._events[a])return!1;var y,_,l=this._events[a],u=arguments.length;if(l.fn){switch(l.once&&this.removeListener(r,l.fn,void 0,!0),u){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,n),!0;case 4:return l.fn.call(l.context,e,n,i),!0;case 5:return l.fn.call(l.context,e,n,i,o),!0;case 6:return l.fn.call(l.context,e,n,i,o,c),!0}for(_=1,y=new Array(u-1);_<u;_++)y[_-1]=arguments[_];l.fn.apply(l.context,y)}else{var A,T=l.length;for(_=0;_<T;_++)switch(l[_].once&&this.removeListener(r,l[_].fn,void 0,!0),u){case 1:l[_].fn.call(l[_].context);break;case 2:l[_].fn.call(l[_].context,e);break;case 3:l[_].fn.call(l[_].context,e,n);break;case 4:l[_].fn.call(l[_].context,e,n,i);break;default:if(!y)for(A=1,y=new Array(u-1);A<u;A++)y[A-1]=arguments[A];l[_].fn.apply(l[_].context,y)}}return!0},oe.prototype.on=function(r,e,n){return Pr(this,r,e,n,!1)},oe.prototype.once=function(r,e,n){return Pr(this,r,e,n,!0)},oe.prototype.removeListener=function(r,e,n,i){var o=ce?ce+r:r;if(!this._events[o])return this;if(!e)return ut(this,o),this;var c=this._events[o];if(c.fn)c.fn===e&&(!i||c.once)&&(!n||c.context===n)&&ut(this,o);else{for(var a=0,l=[],u=c.length;a<u;a++)(c[a].fn!==e||i&&!c[a].once||n&&c[a].context!==n)&&l.push(c[a]);l.length?this._events[o]=1===l.length?l[0]:l:ut(this,o)}return this},oe.prototype.removeAllListeners=function(r){var e;return r?this._events[e=ce?ce+r:r]&&ut(this,e):(this._events=new Ke,this._eventsCount=0),this},oe.prototype.off=oe.prototype.removeListener,oe.prototype.addListener=oe.prototype.on,oe.prefixed=ce,oe.EventEmitter=oe,Ze=oe;var M={};ge(M,"LogLevel",()=>le,t=>le=t),ge(M,"default",()=>Rr,t=>Rr=t);var Me=function(t,r){var e="function"==typeof Symbol&&t[Symbol.iterator];if(!e)return t;var i,c,n=e.call(t),o=[];try{for(;(void 0===r||r-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(a){c={error:a}}finally{try{i&&!i.done&&(e=n.return)&&e.call(n)}finally{if(c)throw c.error}}return o},De=function(t,r,e){if(e||2===arguments.length)for(var o,n=0,i=r.length;n<i;n++)(o||!(n in r))&&(o||(o=Array.prototype.slice.call(r,0,n)),o[n]=r[n]);return t.concat(o||Array.prototype.slice.call(r))},ti="PeerJS: ",le=(()=>{return(t=le||(le={}))[t.Disabled=0]="Disabled",t[t.Errors=1]="Errors",t[t.Warnings=2]="Warnings",t[t.All=3]="All",le;var t})(),ri=function(){function t(){this._logLevel=le.Disabled}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(r){this._logLevel=r},enumerable:!1,configurable:!0}),t.prototype.log=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];this._logLevel>=le.All&&this._print.apply(this,De([le.All],Me(r),!1))},t.prototype.warn=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];this._logLevel>=le.Warnings&&this._print.apply(this,De([le.Warnings],Me(r),!1))},t.prototype.error=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];this._logLevel>=le.Errors&&this._print.apply(this,De([le.Errors],Me(r),!1))},t.prototype.setLogFunction=function(r){this._print=r},t.prototype._print=function(r){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var i=De([ti],Me(e),!1);for(var o in i)i[o]instanceof Error&&(i[o]="("+i[o].name+") "+i[o].message);r>=le.All?console.log.apply(console,De([],Me(i),!1)):r>=le.Warnings?console.warn.apply(console,De(["WARNING"],Me(i),!1)):r>=le.Errors&&console.error.apply(console,De(["ERROR"],Me(i),!1))},t}(),Rr=new ri,Mr={};ge(Mr,"Socket",()=>Dr,t=>Dr=t);var Mt,he=(()=>{return(t=he||(he={})).Data="data",t.Media="media",he;var t})(),J=(()=>{return(t=J||(J={})).BrowserIncompatible="browser-incompatible",t.Disconnected="disconnected",t.InvalidID="invalid-id",t.InvalidKey="invalid-key",t.Network="network",t.PeerUnavailable="peer-unavailable",t.SslUnavailable="ssl-unavailable",t.ServerError="server-error",t.SocketError="socket-error",t.SocketClosed="socket-closed",t.UnavailableID="unavailable-id",t.WebRTC="webrtc",J;var t})(),ye=(()=>{return(t=ye||(ye={})).Binary="binary",t.BinaryUTF8="binary-utf8",t.JSON="json",ye;var t})(),ve=(()=>{return(t=ve||(ve={})).Message="message",t.Disconnected="disconnected",t.Error="error",t.Close="close",ve;var t})(),te=(()=>{return(t=te||(te={})).Heartbeat="HEARTBEAT",t.Candidate="CANDIDATE",t.Offer="OFFER",t.Answer="ANSWER",t.Open="OPEN",t.Error="ERROR",t.IdTaken="ID-TAKEN",t.InvalidKey="INVALID-KEY",t.Leave="LEAVE",t.Expire="EXPIRE",te;var t})();Mt=JSON.parse('{"name":"peerjs","version":"1.4.7","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz St\xfcckler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","So\u0308ren Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.js","browser-unminified":"dist/peerjs.js","types":"dist/types.d.ts","engines":{"node":">= 10"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"context":"browser","outputFormat":"global","optimize":true,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"},"browser-unminified":{"context":"browser","outputFormat":"global","optimize":false,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build","prepublishOnly":"npm run build","test":"mocha -r ts-node/register -r jsdom-global/register test/**/*.ts","format":"prettier --write .","semantic-release":"semantic-release"},"devDependencies":{"@parcel/config-default":"^2.5.0","@parcel/packager-ts":"^2.5.0","@parcel/transformer-typescript-tsc":"^2.5.0","@parcel/transformer-typescript-types":"^2.5.0","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@types/chai":"^4.3.0","@types/mocha":"^9.1.0","@types/node":"^17.0.18","chai":"^4.3.6","git-authors-cli":"^1.0.40","jsdom":"^19.0.0","jsdom-global":"^3.0.2","mocha":"^9.2.0","mock-socket":"8.0.5","parcel":"^2.5.0","parcel-transformer-tsc-sourcemaps":"^1.0.2","prettier":"^2.6.2","semantic-release":"^19.0.2","standard":"^16.0.4","ts-node":"^10.5.0","typescript":"^4.5.5"},"dependencies":{"@swc/helpers":"^0.3.13","eventemitter3":"^4.0.7","peerjs-js-binarypack":"1.0.1","webrtc-adapter":"^7.7.1"}}');var t,ni=(t=function(r,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(r,e)},function(r,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=r}t(r,e),r.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),Dr=function(t){function r(e,n,i,o,c,a){void 0===a&&(a=5e3);var l=t.call(this)||this;return l.pingInterval=a,l._disconnected=!0,l._messagesQueue=[],l._baseUrl=(e?"wss://":"ws://")+n+":"+i+o+"peerjs?key="+c,l}return ni(r,t),r.prototype.start=function(e,n){var i=this;this._id=e;var o="".concat(this._baseUrl,"&id=").concat(e,"&token=").concat(n);this._socket||!this._disconnected||(this._socket=new WebSocket(o+"&version="+Mt.version),this._disconnected=!1,this._socket.onmessage=function(c){var a;try{a=JSON.parse(c.data),M.default.log("Server message received:",a)}catch(l){return void M.default.log("Invalid server message",c.data)}i.emit(ve.Message,a)},this._socket.onclose=function(c){i._disconnected||(M.default.log("Socket closed.",c),i._cleanup(),i._disconnected=!0,i.emit(ve.Disconnected))},this._socket.onopen=function(){i._disconnected||(i._sendQueuedMessages(),M.default.log("Socket open"),i._scheduleHeartbeat())})},r.prototype._scheduleHeartbeat=function(){var e=this;this._wsPingTimer=setTimeout(function(){e._sendHeartbeat()},this.pingInterval)},r.prototype._sendHeartbeat=function(){if(this._wsOpen()){var e=JSON.stringify({type:te.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}else M.default.log("Cannot send heartbeat, because socket closed")},r.prototype._wsOpen=function(){return!!this._socket&&1===this._socket.readyState},r.prototype._sendQueuedMessages=function(){var e,n,i=function(t,r,e){if(e||2===arguments.length)for(var o,n=0,i=r.length;n<i;n++)(o||!(n in r))&&(o||(o=Array.prototype.slice.call(r,0,n)),o[n]=r[n]);return t.concat(o||Array.prototype.slice.call(r))}([],function(t,r){var e="function"==typeof Symbol&&t[Symbol.iterator];if(!e)return t;var i,c,n=e.call(t),o=[];try{for(;(void 0===r||r-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(a){c={error:a}}finally{try{i&&!i.done&&(e=n.return)&&e.call(n)}finally{if(c)throw c.error}}return o}(this._messagesQueue),!1);this._messagesQueue=[];try{for(var o=function(t){var r="function"==typeof Symbol&&Symbol.iterator,e=r&&t[r],n=0;if(e)return e.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}(i),c=o.next();!c.done;c=o.next())this.send(c.value)}catch(l){e={error:l}}finally{try{c&&!c.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}},r.prototype.send=function(e){if(!this._disconnected){if(!this._id)return void this._messagesQueue.push(e);if(!e.type)return void this.emit(ve.Error,"Invalid message");if(this._wsOpen()){var n=JSON.stringify(e);this._socket.send(n)}}},r.prototype.close=function(){this._disconnected||(this._cleanup(),this._disconnected=!0)},r.prototype._cleanup=function(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)},r}(Ze.EventEmitter),Dt={};ge(Dt,"MediaConnection",()=>Or,t=>Or=t);var At={};ge(At,"Negotiator",()=>Ar,t=>Ar=t);var dt=function(){return dt=Object.assign||function(t){for(var r,e=1,n=arguments.length;e<n;e++)for(var i in r=arguments[e])Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i]);return t},dt.apply(this,arguments)},pt=function(t,r,e,n){return new(e||(e=Promise))(function(o,c){function a(y){try{u(n.next(y))}catch(_){c(_)}}function l(y){try{u(n.throw(y))}catch(_){c(_)}}function u(y){y.done?o(y.value):function i(o){return o instanceof e?o:new e(function(c){c(o)})}(y.value).then(a,l)}u((n=n.apply(t,r||[])).next())})},ht=function(t,r){var n,i,o,c,e={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return c={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function a(u){return function(y){return function l(u){if(n)throw new TypeError("Generator is already executing.");for(;e;)try{if(n=1,i&&(o=2&u[0]?i.return:u[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;switch(i=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return e.label++,{value:u[1],done:!1};case 5:e.label++,i=u[1],u=[0];continue;case 7:u=e.ops.pop(),e.trys.pop();continue;default:if(!(o=(o=e.trys).length>0&&o[o.length-1])&&(6===u[0]||2===u[0])){e=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){e.label=u[1];break}if(6===u[0]&&e.label<o[1]){e.label=o[1],o=u;break}if(o&&e.label<o[2]){e.label=o[2],e.ops.push(u);break}o[2]&&e.ops.pop(),e.trys.pop();continue}u=r.call(t,e)}catch(y){u=[6,y],i=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,y])}}},Ar=function(){function t(r){this.connection=r}return t.prototype.startConnection=function(r){var e=this._startPeerConnection();if(this.connection.peerConnection=e,this.connection.type===he.Media&&r._stream&&this._addTracksToConnection(r._stream,e),r.originator){if(this.connection.type===he.Data){var n=this.connection,o=e.createDataChannel(n.label,{ordered:!!r.reliable});n.initialize(o)}this._makeOffer()}else this.handleSDP("OFFER",r.sdp)},t.prototype._startPeerConnection=function(){M.default.log("Creating RTCPeerConnection.");var r=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(r),r},t.prototype._setupListeners=function(r){var e=this,n=this.connection.peer,i=this.connection.connectionId,o=this.connection.type,c=this.connection.provider;M.default.log("Listening for ICE candidates."),r.onicecandidate=function(a){!a.candidate||!a.candidate.candidate||(M.default.log("Received ICE candidates for ".concat(n,":"),a.candidate),c.socket.send({type:te.Candidate,payload:{candidate:a.candidate,type:o,connectionId:i},dst:n}))},r.oniceconnectionstatechange=function(){switch(r.iceConnectionState){case"failed":M.default.log("iceConnectionState is failed, closing connections to "+n),e.connection.emit("error",new Error("Negotiation of connection to "+n+" failed.")),e.connection.close();break;case"closed":M.default.log("iceConnectionState is closed, closing connections to "+n),e.connection.emit("error",new Error("Connection to "+n+" closed.")),e.connection.close();break;case"disconnected":M.default.log("iceConnectionState changed to disconnected on the connection with "+n);break;case"completed":r.onicecandidate=U.noop}e.connection.emit("iceStateChanged",r.iceConnectionState)},M.default.log("Listening for data channel"),r.ondatachannel=function(a){M.default.log("Received data channel");var l=a.channel;c.getConnection(n,i).initialize(l)},M.default.log("Listening for remote stream"),r.ontrack=function(a){M.default.log("Received remote stream");var l=a.streams[0],u=c.getConnection(n,i);u.type===he.Media&&e._addStreamToMediaConnection(l,u)}},t.prototype.cleanup=function(){M.default.log("Cleaning up PeerConnection to "+this.connection.peer);var r=this.connection.peerConnection;if(r){this.connection.peerConnection=null,r.onicecandidate=r.oniceconnectionstatechange=r.ondatachannel=r.ontrack=function(){};var n=!1;if(this.connection.type===he.Data){var o=this.connection.dataChannel;o&&(n=!!o.readyState&&"closed"!==o.readyState)}("closed"!==r.signalingState||n)&&r.close()}},t.prototype._makeOffer=function(){return pt(this,void 0,Promise,function(){var r,e,n,i,o,c,a;return ht(this,function(l){switch(l.label){case 0:r=this.connection.peerConnection,e=this.connection.provider,l.label=1;case 1:return l.trys.push([1,7,,8]),[4,r.createOffer(this.connection.options.constraints)];case 2:n=l.sent(),M.default.log("Created offer."),this.connection.options.sdpTransform&&"function"==typeof this.connection.options.sdpTransform&&(n.sdp=this.connection.options.sdpTransform(n.sdp)||n.sdp),l.label=3;case 3:return l.trys.push([3,5,,6]),[4,r.setLocalDescription(n)];case 4:return l.sent(),M.default.log("Set localDescription:",n,"for:".concat(this.connection.peer)),i={sdp:n,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:U.browser},this.connection.type===he.Data&&(o=this.connection,i=dt(dt({},i),{label:o.label,reliable:o.reliable,serialization:o.serialization})),e.socket.send({type:te.Offer,payload:i,dst:this.connection.peer}),[3,6];case 5:return"OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"!=(c=l.sent())&&(e.emitError(J.WebRTC,c),M.default.log("Failed to setLocalDescription, ",c)),[3,6];case 6:return[3,8];case 7:return a=l.sent(),e.emitError(J.WebRTC,a),M.default.log("Failed to createOffer, ",a),[3,8];case 8:return[2]}})})},t.prototype._makeAnswer=function(){return pt(this,void 0,Promise,function(){var r,e,n,i,o;return ht(this,function(c){switch(c.label){case 0:r=this.connection.peerConnection,e=this.connection.provider,c.label=1;case 1:return c.trys.push([1,7,,8]),[4,r.createAnswer()];case 2:n=c.sent(),M.default.log("Created answer."),this.connection.options.sdpTransform&&"function"==typeof this.connection.options.sdpTransform&&(n.sdp=this.connection.options.sdpTransform(n.sdp)||n.sdp),c.label=3;case 3:return c.trys.push([3,5,,6]),[4,r.setLocalDescription(n)];case 4:return c.sent(),M.default.log("Set localDescription:",n,"for:".concat(this.connection.peer)),e.socket.send({type:te.Answer,payload:{sdp:n,type:this.connection.type,connectionId:this.connection.connectionId,browser:U.browser},dst:this.connection.peer}),[3,6];case 5:return i=c.sent(),e.emitError(J.WebRTC,i),M.default.log("Failed to setLocalDescription, ",i),[3,6];case 6:return[3,8];case 7:return o=c.sent(),e.emitError(J.WebRTC,o),M.default.log("Failed to create answer, ",o),[3,8];case 8:return[2]}})})},t.prototype.handleSDP=function(r,e){return pt(this,void 0,Promise,function(){var n,i,o,c;return ht(this,function(a){switch(a.label){case 0:e=new RTCSessionDescription(e),n=this.connection.peerConnection,i=this.connection.provider,M.default.log("Setting remote description",e),o=this,a.label=1;case 1:return a.trys.push([1,5,,6]),[4,n.setRemoteDescription(e)];case 2:return a.sent(),M.default.log("Set remoteDescription:".concat(r," for:").concat(this.connection.peer)),"OFFER"!==r?[3,4]:[4,o._makeAnswer()];case 3:a.sent(),a.label=4;case 4:return[3,6];case 5:return c=a.sent(),i.emitError(J.WebRTC,c),M.default.log("Failed to setRemoteDescription, ",c),[3,6];case 6:return[2]}})})},t.prototype.handleCandidate=function(r){return pt(this,void 0,Promise,function(){var e,n,i,o,c,a;return ht(this,function(l){switch(l.label){case 0:M.default.log("handleCandidate:",r),e=r.candidate,n=r.sdpMLineIndex,i=r.sdpMid,o=this.connection.peerConnection,c=this.connection.provider,l.label=1;case 1:return l.trys.push([1,3,,4]),[4,o.addIceCandidate(new RTCIceCandidate({sdpMid:i,sdpMLineIndex:n,candidate:e}))];case 2:return l.sent(),M.default.log("Added ICE candidate for:".concat(this.connection.peer)),[3,4];case 3:return a=l.sent(),c.emitError(J.WebRTC,a),M.default.log("Failed to handleCandidate, ",a),[3,4];case 4:return[2]}})})},t.prototype._addTracksToConnection=function(r,e){if(M.default.log("add tracks from stream ".concat(r.id," to peer connection")),!e.addTrack)return M.default.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");r.getTracks().forEach(function(n){e.addTrack(n,r)})},t.prototype._addStreamToMediaConnection=function(r,e){M.default.log("add stream ".concat(r.id," to media connection ").concat(e.connectionId)),e.addStream(r)},t}(),Vt={};ge(Vt,"BaseConnection",()=>Vr,t=>Vr=t);var ai=function(){var t=function(r,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(r,e)};return function(r,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=r}t(r,e),r.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),Vr=function(t){function r(e,n,i){var o=t.call(this)||this;return o.peer=e,o.provider=n,o.options=i,o._open=!1,o.metadata=i.metadata,o}return ai(r,t),Object.defineProperty(r.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),r}(Ze.EventEmitter),ci=function(){var t=function(r,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(r,e)};return function(r,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=r}t(r,e),r.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),ft=function(){return ft=Object.assign||function(t){for(var r,e=1,n=arguments.length;e<n;e++)for(var i in r=arguments[e])Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i]);return t},ft.apply(this,arguments)},Or=function(t){function r(e,n,i){var o=t.call(this,e,n,i)||this;return o._localStream=o.options._stream,o.connectionId=o.options.connectionId||r.ID_PREFIX+U.randomToken(),o._negotiator=new At.Negotiator(o),o._localStream&&o._negotiator.startConnection({_stream:o._localStream,originator:!0}),o}return ci(r,t),Object.defineProperty(r.prototype,"type",{get:function(){return he.Media},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"localStream",{get:function(){return this._localStream},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"remoteStream",{get:function(){return this._remoteStream},enumerable:!1,configurable:!0}),r.prototype.addStream=function(e){M.default.log("Receiving stream",e),this._remoteStream=e,t.prototype.emit.call(this,"stream",e)},r.prototype.handleMessage=function(e){var n=e.type,i=e.payload;switch(e.type){case te.Answer:this._negotiator.handleSDP(n,i.sdp),this._open=!0;break;case te.Candidate:this._negotiator.handleCandidate(i.candidate);break;default:M.default.warn("Unrecognized message type:".concat(n," from peer:").concat(this.peer))}},r.prototype.answer=function(e,n){var i,o;if(void 0===n&&(n={}),this._localStream)M.default.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");else{this._localStream=e,n&&n.sdpTransform&&(this.options.sdpTransform=n.sdpTransform),this._negotiator.startConnection(ft(ft({},this.options._payload),{_stream:e}));var c=this.provider._getMessages(this.connectionId);try{for(var a=function(t){var r="function"==typeof Symbol&&Symbol.iterator,e=r&&t[r],n=0;if(e)return e.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}(c),l=a.next();!l.done;l=a.next())this.handleMessage(l.value)}catch(y){i={error:y}}finally{try{l&&!l.done&&(o=a.return)&&o.call(a)}finally{if(i)throw i.error}}this._open=!0}},r.prototype.close=function(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,t.prototype.emit.call(this,"close"))},r.ID_PREFIX="mc_",r}(Vt.BaseConnection),Ot={};ge(Ot,"DataConnection",()=>Br,t=>Br=t);var Ir={};ge(Ir,"EncodingQueue",()=>wr,t=>wr=t);var ui=function(){var t=function(r,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(r,e)};return function(r,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=r}t(r,e),r.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),wr=function(t){function r(){var e=t.call(this)||this;return e.fileReader=new FileReader,e._queue=[],e._processing=!1,e.fileReader.onload=function(n){e._processing=!1,n.target&&e.emit("done",n.target.result),e.doNextTask()},e.fileReader.onerror=function(n){M.default.error("EncodingQueue error:",n),e._processing=!1,e.destroy(),e.emit("error",n)},e}return ui(r,t),Object.defineProperty(r.prototype,"queue",{get:function(){return this._queue},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"size",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"processing",{get:function(){return this._processing},enumerable:!1,configurable:!0}),r.prototype.enque=function(e){this.queue.push(e),!this.processing&&this.doNextTask()},r.prototype.destroy=function(){this.fileReader.abort(),this._queue=[]},r.prototype.doNextTask=function(){0!==this.size&&(this.processing||(this._processing=!0,this.fileReader.readAsArrayBuffer(this.queue.shift())))},r}(Ze.EventEmitter),di=function(){var t=function(r,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(r,e)};return function(r,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=r}t(r,e),r.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),Br=function(t){function r(e,n,i){var o=t.call(this,e,n,i)||this;return o.stringify=JSON.stringify,o.parse=JSON.parse,o._buffer=[],o._bufferSize=0,o._buffering=!1,o._chunkedData={},o._encodingQueue=new Ir.EncodingQueue,o.connectionId=o.options.connectionId||r.ID_PREFIX+U.randomToken(),o.label=o.options.label||o.connectionId,o.serialization=o.options.serialization||ye.Binary,o.reliable=!!o.options.reliable,o._encodingQueue.on("done",function(c){o._bufferedSend(c)}),o._encodingQueue.on("error",function(){M.default.error("DC#".concat(o.connectionId,": Error occured in encoding from blob to arraybuffer, close DC")),o.close()}),o._negotiator=new At.Negotiator(o),o._negotiator.startConnection(o.options._payload||{originator:!0}),o}return di(r,t),Object.defineProperty(r.prototype,"type",{get:function(){return he.Data},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"dataChannel",{get:function(){return this._dc},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"bufferSize",{get:function(){return this._bufferSize},enumerable:!1,configurable:!0}),r.prototype.initialize=function(e){this._dc=e,this._configureDataChannel()},r.prototype._configureDataChannel=function(){var e=this;(!U.supports.binaryBlob||U.supports.reliable)&&(this.dataChannel.binaryType="arraybuffer"),this.dataChannel.onopen=function(){M.default.log("DC#".concat(e.connectionId," dc connection success")),e._open=!0,e.emit("open")},this.dataChannel.onmessage=function(n){M.default.log("DC#".concat(e.connectionId," dc onmessage:"),n.data),e._handleDataMessage(n)},this.dataChannel.onclose=function(){M.default.log("DC#".concat(e.connectionId," dc closed for:"),e.peer),e.close()}},r.prototype._handleDataMessage=function(e){var n=this,i=e.data,o=i.constructor,a=i;if(this.serialization===ye.Binary||this.serialization===ye.BinaryUTF8){if(o===Blob)return void U.blobToArrayBuffer(i,function(u){var y=U.unpack(u);n.emit("data",y)});if(o===ArrayBuffer)a=U.unpack(i);else if(o===String){var l=U.binaryStringToArrayBuffer(i);a=U.unpack(l)}}else this.serialization===ye.JSON&&(a=this.parse(i));a.__peerData?this._handleChunk(a):t.prototype.emit.call(this,"data",a)},r.prototype._handleChunk=function(e){var n=e.__peerData,i=this._chunkedData[n]||{data:[],count:0,total:e.total};if(i.data[e.n]=e.data,i.count++,this._chunkedData[n]=i,i.total===i.count){delete this._chunkedData[n];var o=new Blob(i.data);this._handleDataMessage({data:o})}},r.prototype.close=function(){this._buffer=[],this._bufferSize=0,this._chunkedData={},this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this._dc=null),this._encodingQueue&&(this._encodingQueue.destroy(),this._encodingQueue.removeAllListeners(),this._encodingQueue=null),this.open&&(this._open=!1,t.prototype.emit.call(this,"close"))},r.prototype.send=function(e,n){if(this.open)if(this.serialization===ye.JSON)this._bufferedSend(this.stringify(e));else if(this.serialization===ye.Binary||this.serialization===ye.BinaryUTF8){var i=U.pack(e);if(!n&&i.size>U.chunkedMTU)return void this._sendChunks(i);U.supports.binaryBlob?this._bufferedSend(i):this._encodingQueue.enque(i)}else this._bufferedSend(e);else t.prototype.emit.call(this,"error",new Error("Connection is not open. You should listen for the `open` event before sending messages."))},r.prototype._bufferedSend=function(e){(this._buffering||!this._trySend(e))&&(this._buffer.push(e),this._bufferSize=this._buffer.length)},r.prototype._trySend=function(e){var n=this;if(!this.open)return!1;if(this.dataChannel.bufferedAmount>r.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(function(){n._buffering=!1,n._tryBuffer()},50),!1;try{this.dataChannel.send(e)}catch(i){return M.default.error("DC#:".concat(this.connectionId," Error when sending:"),i),this._buffering=!0,this.close(),!1}return!0},r.prototype._tryBuffer=function(){this.open&&0!==this._buffer.length&&this._trySend(this._buffer[0])&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())},r.prototype._sendChunks=function(e){var n,i,o=U.chunk(e);M.default.log("DC#".concat(this.connectionId," Try to send ").concat(o.length," chunks..."));try{for(var c=function(t){var r="function"==typeof Symbol&&Symbol.iterator,e=r&&t[r],n=0;if(e)return e.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}(o),a=c.next();!a.done;a=c.next())this.send(a.value,!0)}catch(u){n={error:u}}finally{try{a&&!a.done&&(i=c.return)&&i.call(c)}finally{if(n)throw n.error}}},r.prototype.handleMessage=function(e){var n=e.payload;switch(e.type){case te.Answer:this._negotiator.handleSDP(e.type,n.sdp);break;case te.Candidate:this._negotiator.handleCandidate(n.candidate);break;default:M.default.warn("Unrecognized message type:",e.type,"from peer:",this.peer)}},r.ID_PREFIX="dc_",r.MAX_BUFFERED_AMOUNT=8388608,r}(Vt.BaseConnection),Fr={};ge(Fr,"API",()=>Nr,t=>Nr=t);var jr=function(t,r,e,n){return new(e||(e=Promise))(function(o,c){function a(y){try{u(n.next(y))}catch(_){c(_)}}function l(y){try{u(n.throw(y))}catch(_){c(_)}}function u(y){y.done?o(y.value):function i(o){return o instanceof e?o:new e(function(c){c(o)})}(y.value).then(a,l)}u((n=n.apply(t,r||[])).next())})},Gr=function(t,r){var n,i,o,c,e={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return c={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function a(u){return function(y){return function l(u){if(n)throw new TypeError("Generator is already executing.");for(;e;)try{if(n=1,i&&(o=2&u[0]?i.return:u[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;switch(i=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return e.label++,{value:u[1],done:!1};case 5:e.label++,i=u[1],u=[0];continue;case 7:u=e.ops.pop(),e.trys.pop();continue;default:if(!(o=(o=e.trys).length>0&&o[o.length-1])&&(6===u[0]||2===u[0])){e=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){e.label=u[1];break}if(6===u[0]&&e.label<o[1]){e.label=o[1],o=u;break}if(o&&e.label<o[2]){e.label=o[2],e.ops.push(u);break}o[2]&&e.ops.pop(),e.trys.pop();continue}u=r.call(t,e)}catch(y){u=[6,y],i=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,y])}}},Nr=function(){function t(r){this._options=r}return t.prototype._buildRequest=function(r){var n=this._options,i=n.host,o=n.port,c=n.path,a=n.key,l=new URL("".concat(this._options.secure?"https":"http","://").concat(i,":").concat(o).concat(c).concat(a,"/").concat(r));return l.searchParams.set("ts","".concat(Date.now()).concat(Math.random())),l.searchParams.set("version",Mt.version),fetch(l.href,{referrerPolicy:this._options.referrerPolicy})},t.prototype.retrieveId=function(){return jr(this,void 0,Promise,function(){var r,e,n;return Gr(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this._buildRequest("id")];case 1:if(200!==(r=i.sent()).status)throw new Error("Error. Status:".concat(r.status));return[2,r.text()];case 2:throw e=i.sent(),M.default.error("Error retrieving ID",e),n="","/"===this._options.path&&this._options.host!==U.CLOUD_HOST&&(n=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+n);case 3:return[2]}})})},t.prototype.listAllPeers=function(){return jr(this,void 0,Promise,function(){var r,e,n;return Gr(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this._buildRequest("peers")];case 1:if(200!==(r=i.sent()).status)throw 401===r.status?("",e=this._options.host===U.CLOUD_HOST?"It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":"You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+e)):new Error("Error. Status:".concat(r.status));return[2,r.json()];case 2:throw n=i.sent(),M.default.error("Error retrieving list peers",n),new Error("Could not get list peers from the server."+n);case 3:return[2]}})})},t}(),hi=function(){var t=function(r,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])})(r,e)};return function(r,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=r}t(r,e),r.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),Xe=function(){return Xe=Object.assign||function(t){for(var r,e=1,n=arguments.length;e<n;e++)for(var i in r=arguments[e])Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i]);return t},Xe.apply(this,arguments)},Qe=function(t){var r="function"==typeof Symbol&&Symbol.iterator,e=r&&t[r],n=0;if(e)return e.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")},fi=function(t,r){var e="function"==typeof Symbol&&t[Symbol.iterator];if(!e)return t;var i,c,n=e.call(t),o=[];try{for(;(void 0===r||r-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(a){c={error:a}}finally{try{i&&!i.done&&(e=n.return)&&e.call(n)}finally{if(c)throw c.error}}return o},It=function(t){function r(e,n){var o,i=t.call(this)||this;return i._id=null,i._lastServerId=null,i._destroyed=!1,i._disconnected=!1,i._open=!1,i._connections=new Map,i._lostMessages=new Map,e&&e.constructor==Object?n=e:e&&(o=e.toString()),n=Xe({debug:0,host:U.CLOUD_HOST,port:U.CLOUD_PORT,path:"/",key:r.DEFAULT_KEY,token:U.randomToken(),config:U.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin"},n),i._options=n,"/"===i._options.host&&(i._options.host=window.location.hostname),i._options.path&&("/"!==i._options.path[0]&&(i._options.path="/"+i._options.path),"/"!==i._options.path[i._options.path.length-1]&&(i._options.path+="/")),void 0===i._options.secure&&i._options.host!==U.CLOUD_HOST?i._options.secure=U.isSecure():i._options.host==U.CLOUD_HOST&&(i._options.secure=!0),i._options.logFunction&&M.default.setLogFunction(i._options.logFunction),M.default.logLevel=i._options.debug||0,i._api=new Fr.API(n),i._socket=i._createServerConnection(),U.supports.audioVideo||U.supports.data?o&&!U.validateId(o)?(i._delayedAbort(J.InvalidID,'ID "'.concat(o,'" is invalid')),i):(o?i._initialize(o):i._api.retrieveId().then(function(c){return i._initialize(c)}).catch(function(c){return i._abort(J.ServerError,c)}),i):(i._delayedAbort(J.BrowserIncompatible,"The current browser does not support WebRTC"),i)}return hi(r,t),Object.defineProperty(r.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"socket",{get:function(){return this._socket},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"connections",{get:function(){var e,n,i=Object.create(null);try{for(var o=Qe(this._connections),c=o.next();!c.done;c=o.next()){var a=fi(c.value,2);i[a[0]]=a[1]}}catch(y){e={error:y}}finally{try{c&&!c.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return i},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"disconnected",{get:function(){return this._disconnected},enumerable:!1,configurable:!0}),r.prototype._createServerConnection=function(){var e=this,n=new Mr.Socket(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return n.on(ve.Message,function(i){e._handleMessage(i)}),n.on(ve.Error,function(i){e._abort(J.SocketError,i)}),n.on(ve.Disconnected,function(){e.disconnected||(e.emitError(J.Network,"Lost connection to server."),e.disconnect())}),n.on(ve.Close,function(){e.disconnected||e._abort(J.SocketClosed,"Underlying socket is already closed.")}),n},r.prototype._initialize=function(e){this._id=e,this.socket.start(e,this._options.token)},r.prototype._handleMessage=function(e){var n,i,o=e.type,c=e.payload,a=e.src;switch(o){case te.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case te.Error:this._abort(J.ServerError,c.msg);break;case te.IdTaken:this._abort(J.UnavailableID,'ID "'.concat(this.id,'" is taken'));break;case te.InvalidKey:this._abort(J.InvalidKey,'API KEY "'.concat(this._options.key,'" is invalid'));break;case te.Leave:M.default.log("Received leave message from ".concat(a)),this._cleanupPeer(a),this._connections.delete(a);break;case te.Expire:this.emitError(J.PeerUnavailable,"Could not connect to peer ".concat(a));break;case te.Offer:if((V=this.getConnection(a,D=c.connectionId))&&(V.close(),M.default.warn("Offer received for existing Connection ID:".concat(D))),c.type===he.Media){var l=new Dt.MediaConnection(a,this,{connectionId:D,_payload:c,metadata:c.metadata});this._addConnection(a,V=l),this.emit("call",l)}else{if(c.type!==he.Data)return void M.default.warn("Received malformed connection type:".concat(c.type));var u=new Ot.DataConnection(a,this,{connectionId:D,_payload:c,metadata:c.metadata,label:c.label,serialization:c.serialization,reliable:c.reliable});this._addConnection(a,V=u),this.emit("connection",u)}var y=this._getMessages(D);try{for(var _=Qe(y),T=_.next();!T.done;T=_.next())V.handleMessage(T.value)}catch(Z){n={error:Z}}finally{try{T&&!T.done&&(i=_.return)&&i.call(_)}finally{if(n)throw n.error}}break;default:if(!c)return void M.default.warn("You received a malformed message from ".concat(a," of type ").concat(o));var D,V;(V=this.getConnection(a,D=c.connectionId))&&V.peerConnection?V.handleMessage(e):D?this._storeMessage(D,e):M.default.warn("You received an unrecognized message:",e)}},r.prototype._storeMessage=function(e,n){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(n)},r.prototype._getMessages=function(e){var n=this._lostMessages.get(e);return n?(this._lostMessages.delete(e),n):[]},r.prototype.connect=function(e,n){if(void 0===n&&(n={}),this.disconnected)return M.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),void this.emitError(J.Disconnected,"Cannot connect to new Peer after disconnecting from server.");var i=new Ot.DataConnection(e,this,n);return this._addConnection(e,i),i},r.prototype.call=function(e,n,i){if(void 0===i&&(i={}),this.disconnected)return M.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),void this.emitError(J.Disconnected,"Cannot connect to new Peer after disconnecting from server.");if(n){var o=new Dt.MediaConnection(e,this,Xe(Xe({},i),{_stream:n}));return this._addConnection(e,o),o}M.default.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.")},r.prototype._addConnection=function(e,n){M.default.log("add connection ".concat(n.type,":").concat(n.connectionId," to peerId:").concat(e)),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(n)},r.prototype._removeConnection=function(e){var n=this._connections.get(e.peer);if(n){var i=n.indexOf(e);-1!==i&&n.splice(i,1)}this._lostMessages.delete(e.connectionId)},r.prototype.getConnection=function(e,n){var i,o,c=this._connections.get(e);if(!c)return null;try{for(var a=Qe(c),l=a.next();!l.done;l=a.next()){var u=l.value;if(u.connectionId===n)return u}}catch(y){i={error:y}}finally{try{l&&!l.done&&(o=a.return)&&o.call(a)}finally{if(i)throw i.error}}return null},r.prototype._delayedAbort=function(e,n){var i=this;setTimeout(function(){i._abort(e,n)},0)},r.prototype._abort=function(e,n){M.default.error("Aborting!"),this.emitError(e,n),this._lastServerId?this.disconnect():this.destroy()},r.prototype.emitError=function(e,n){var i;M.default.error("Error:",n),(i="string"==typeof n?new Error(n):n).type=e,this.emit("error",i)},r.prototype.destroy=function(){this.destroyed||(M.default.log("Destroy peer with ID:".concat(this.id)),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))},r.prototype._cleanup=function(){var e,n;try{for(var i=Qe(this._connections.keys()),o=i.next();!o.done;o=i.next()){var c=o.value;this._cleanupPeer(c),this._connections.delete(c)}}catch(a){e={error:a}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}this.socket.removeAllListeners()},r.prototype._cleanupPeer=function(e){var n,i,o=this._connections.get(e);if(o)try{for(var c=Qe(o),a=c.next();!a.done;a=c.next())a.value.close()}catch(u){n={error:u}}finally{try{a&&!a.done&&(i=c.return)&&i.call(c)}finally{if(n)throw n.error}}},r.prototype.disconnect=function(){if(!this.disconnected){var e=this.id;M.default.log("Disconnect peer with ID:".concat(e)),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit("disconnected",e)}},r.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)M.default.log("Attempting reconnection to server with ID ".concat(this._lastServerId)),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(this.disconnected||this.open)throw new Error("Peer ".concat(this.id," cannot reconnect because it is not disconnected from the server!"));M.default.error("In a hurry? We're still trying to make the initial connection!")}},r.prototype.listAllPeers=function(e){var n=this;void 0===e&&(e=function(i){}),this._api.listAllPeers().then(function(i){return e(i)}).catch(function(i){return n._abort(J.ServerError,i)})},r.DEFAULT_KEY="peerjs",r}(Ze.EventEmitter),wt=d(7579),se=(()=>(function(t){t.Ready="ready",t.Unready="unready"}(se||(se={})),se))(),Ae=(()=>(function(t){t.Host="host",t.Peer="peer"}(Ae||(Ae={})),Ae))(),Lr=d(7232);let mi=(()=>{class t{constructor(e,n){this.core=e,this.translateService=n,this.heartbeatLength=5e3,this.peers=[],this.refreshUi=new wt.x,this.playerAction=new wt.x,this.disconnectedPeerIndex=new wt.x,this.heartbeatCheck=!1}initializePeer(){let e;this.peers=[],this._connections=[],this._peerType=Ae.Host,this._peer=new It({config:{iceServers:[{urls:["stun:51.15.25.223:3478"]},{urls:["turn:51.15.25.223:3478"],username:"warcry",credential:"companion"}]}}),this._peerState=se.Unready,this._peer.on("connection",n=>{n.on("data",i=>{switch(i.data.type){case"join":if(this.peers.findIndex(o=>o.peerId===n.peer)<0){this.privateMessage({peerId:this._peerId,data:{type:"roster"}},n.peer);const o=i.data.peer;console.log("multiplayer.dialog.peer-joined",{peer:o}),this.playerAction.next({changed:"joined"}),o.hostIndex=this.peers.length,this.peers.push(o),this.refreshUi.next(null),this.broadcast({peerId:n.peer,data:{type:"join",peer:o}})}break;case"ready":e=this.peers.findIndex(o=>o.peerId===i.peerId),e>-1&&(this.peers[e].state=se.Ready,this.refreshUi.next(null),this.broadcast(i));break;case"unready":e=this.peers.findIndex(o=>o.peerId===i.peerId),e>-1&&(this.peers[e].state=se.Unready,this.refreshUi.next(null),this.broadcast(i));break;case"heartbeat":n.heartbeat=Date.now(),this.privateMessage({peerId:this.peerId,data:{type:"heartbeat"}},n.peer),this.interval||(this.interval=setInterval(()=>{const o=Date.now();this._connections.forEach(c=>{if(c.heartbeat<o-2*this.heartbeatLength){let a=this.peers.findIndex(l=>l.peerId===c.peer);this.disconnectedPeerIndex.next(a),a>-1&&(console.log("multiplayer.dialog.peer-disconnected",{peer:this.peers[a]}),this.peers.splice(a,1),this.broadcast({peerId:this._peerId,data:{type:"disconnected",peer:c.peer}}),this.refreshUi.next(null)),a=this._connections.findIndex(l=>l.peer===c.peer),a>-1&&this._connections.splice(a,1)}})},this.heartbeatLength+1e3));break;case"state-change":this.handleStateChange(i.peerId,i.data),this.broadcast(i);break;case"disconnected":e=this.peers.findIndex(o=>o.peerId===i.data.peer),e>-1&&(this.peers.splice(e,1),this.refreshUi.next(null))}}),n.on("open",()=>{this.privateMessage({peerId:this._peerId,data:{type:"session",peers:this.peers,hostState:this.peerState}},n.peer)}),n.on("close",()=>{const i=this.peers.findIndex(o=>o.peerId===n.peer);this.disconnectedPeerIndex.next(i),i>-1&&(console.log("multiplayer.dialog.peer-disconnected",{peer:this.peers[i]}),this.peers.splice(i,1),this.broadcast({peerId:this._peerId,data:{type:"disconnected",peer:n.peer}}),this.refreshUi.next(null))}),n.heartbeat=Date.now(),this._connections.push(n)}),this._peer.on("open",n=>{this._peerId=n})}connectPeer(e,n=(()=>{})){this.core.startLoader();let o,i=!0;setTimeout(()=>{i&&(this.core.stopLoader(),this.disconnect())},5e3),this._peerType=Ae.Peer,this._connections=[],this.peers=[];const c=this._peer.connect(e);c.on("open",()=>{i=!1,this.broadcast({peerId:this._peerId,data:{type:"join",peer:{peerId:this._peerId,state:se.Unready}}}),this.interval=setInterval(()=>{this.broadcast({peerId:this.peerId,data:{type:"heartbeat"}}),this.heartbeatCheck=!0,setTimeout(()=>{this.heartbeatCheck&&this.disconnect()},1e3)},this.heartbeatLength)}),c.on("close",()=>{console.log("multiplayer.dialog.disconnected"),this.disconnectedPeerIndex.next(-1),this.disconnect()}),c.on("data",a=>{if(a.peerId!==this._peerId)switch(a.data.type){case"session":console.log("multiplayer.dialog.joined",{peer:a.data}),this.peers.push({peerId:c.peer,state:a.data.hostState,type:Ae.Host}),this.peers.push(...a.data.peers.filter(l=>l.peerId!=this._peerId)),n(),this.core.stopLoader(),this.refreshUi.next(null);break;case"join":console.log("multiplayer.dialog.peer-joined",{peer:a.data.peer}),this.peers.push(a.data.peer),this.refreshUi.next(null);break;case"ready":o=this.peers.findIndex(l=>l.peerId===a.peerId),o>-1&&(this.peers[o].state=se.Ready,this.refreshUi.next(null));break;case"unready":o=this.peers.findIndex(l=>l.peerId===a.peerId),o>-1&&(this.peers[o].state=se.Unready,this.refreshUi.next(null));break;case"heartbeat":this.heartbeatCheck=!1;break;case"state-change":this.handleStateChange(a.peerId,a.data);break;case"disconnected":o=this.peers.findIndex(l=>l.peerId===a.data.peer),this.disconnectedPeerIndex.next(o),o>-1&&(console.log("multiplayer.dialog.peer-disconnected",{peer:this.peers[o]}),this.peers.splice(o,1),this.refreshUi.next(null))}}),this._connections.push(c)}ready(){this._peerState=se.Ready,this.broadcast({peerId:this.peerId,data:{type:"ready"}})}unready(){this._peerState=se.Unready,this.broadcast({peerId:this.peerId,data:{type:"unready"}})}disconnect(){clearInterval(this.interval),this._peer.destroy(),this.initializePeer(),this.refreshUi.next(null)}stateChange(e){this.broadcast({peerId:this.peerId,data:Object.assign({type:"state-change"},e)}),this.refreshUi.next(null)}handleStateChange(e,n){"end-turn"===n.changed?(this._peerState=se.Unready,this.peers.forEach(o=>o.state=se.Unready)):this.playerAction.next(n)}broadcast(e){this._connections.forEach(n=>{e.peerId!==n.peer&&n.send(e)})}privateMessage(e,n){const i=this._connections.find(o=>n===o.peer);i&&i.send(e)}get peerId(){return this._peerId}get peerType(){return this._peerType}get host(){return this._peerType===Ae.Host}get peerState(){return this._peerState}get connected(){return this.peers.length>0}get allReady(){return this._peerState===se.Ready&&-1===this.peers.findIndex(e=>e.state===se.Unready)}get meReady(){return this._peerState===se.Ready}}return t.\u0275fac=function(e){return new(e||t)(s.LFG(B.p),s.LFG(Lr.sK))},t.\u0275prov=s.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var gi=d(9601);const yi=[[["","top",""]],[["","bottom",""]]],vi=["[top]","[bottom]"];let _i=(()=>{class t{constructor(){}ngOnInit(){}onClick(e){e.stopPropagation()}onClickEnd(e){e.stopPropagation()}onMouseMove(e){e.stopPropagation()}onWheel(e){e.stopPropagation()}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=s.Xpm({type:t,selectors:[["smitd-game-hud"]],hostBindings:function(e,n){1&e&&s.NdJ("mousedown",function(o){return n.onClick(o)})("mouseup",function(o){return n.onClickEnd(o)})("mousemove",function(o){return n.onMouseMove(o)})("wheel",function(o){return n.onWheel(o)})},ngContentSelectors:vi,decls:4,vars:0,consts:[[1,"top"],[1,"bottom"]],template:function(e,n){1&e&&(s.F$t(yi),s.TgZ(0,"div",0),s.Hsn(1),s.qZA(),s.TgZ(2,"div",1),s.Hsn(3,1),s.qZA())},styles:["[_nghost-%COMP%]{display:contents}.top[_ngcontent-%COMP%]{position:fixed;z-index:10;top:0;left:0;right:0;height:40px;background-color:#6b604c;display:flex;justify-content:space-between;align-items:center}.bottom[_ngcontent-%COMP%]{position:fixed;z-index:10;bottom:0;left:0;right:0;height:80px;background-color:#6b604c;display:flex;justify-content:space-between;align-items:flex-end}"]}),t})();var Ci=d(7423),bi=d(678),_e=(()=>(function(t){t[t.ACTIVE=1]="ACTIVE",t[t.ISLAND_SLEEPING=2]="ISLAND_SLEEPING",t[t.WANTS_DEACTIVATION=3]="WANTS_DEACTIVATION",t[t.DISABLE_DEACTIVATION=4]="DISABLE_DEACTIVATION",t[t.DISABLE_SIMULATION=5]="DISABLE_SIMULATION"}(_e||(_e={})),_e))();const Si=[{path:"",component:(()=>{class t{constructor(e,n,i,o,c){this.soundService=e,this.coreService=n,this.socketService=i,this.ammoService=o,this.element=c,this.rigidBodies=[],this.cameraMovement={distance:80,distanceChange:0,up:0,down:0,left:0,right:0,shift:1,xBoundary:0,zBoundary:0,dragOrigin:null,dragOriginCameraPositon:new v.Pa4,dragX:0,dragZ:0},this.mapSize={width:2e3,height:2e3},this.friction=10,this.rollingFriction=10,this.gravity=-490,this.colGroupPlayer=1,this.colGroupPlane=2,this.colGroupBall=4,this.showInteractables=!1,this.pixelate=!1,this.characters=[],this.players=[],this.socketService.initializePeer()}ngAfterViewInit(){this.ammoService.Ammo.subscribe(e=>{this.Ammo=e,this.tmpVec=new this.Ammo.btVector3(0,0,0),this.tmpTrans=new this.Ammo.btTransform,this.init(),this.update(),this.socketService.playerAction.subscribe(n=>{switch(n.changed){case"spawn":this.createPlayer(4,10,n.pos,n.color);break;case"joined":this.socketService.stateChange({changed:"spawn",pos:this.character.model.position,color:this.character.info.color});break;case"action":"move"===(console.log("RECIEVED ACTION",n),n.action.type)&&(this.players[0].info.move=!0,this.players[0].info.targetPosition=n.action.targetPosition)}})})}get myPeerId(){return this.socketService.peerId}connectToHost(e){this.socketService.connectPeer(e,()=>{this.socketService.stateChange({changed:"spawn",pos:this.character.model.position,color:this.character.info.color})})}sendAction(e){console.log("action",e),this.socketService.stateChange({changed:"action",action:e})}ngOnDestroy(){}init(){this.setupPhysicsWorld(),this.setupGraphics(),this.setupWorld(),this.setupControls()}setupPhysicsWorld(){const e=new this.Ammo.btDefaultCollisionConfiguration,n=new this.Ammo.btCollisionDispatcher(e),i=new this.Ammo.btDbvtBroadphase,o=new this.Ammo.btSequentialImpulseConstraintSolver;this.physicsWorld=new this.Ammo.btDiscreteDynamicsWorld(n,i,o,e),this.tmpVec.setValue(0,this.gravity,0),this.physicsWorld.setGravity(this.tmpVec)}setupGraphics(){this.clock=new v.SUY,this.scene=new v.xsS,this.scene.background=new v.Ilk("#DFE9F3"),this.setupCamera(),this.setupLights(),this.setupFog(),this.setupRenderer(),this.setupAnimationMixer(),this.setupComposer()}setupCamera(){this.camera=new v.cPb(70,window.innerWidth/window.innerHeight,1,2e3),this.camera.position.set(0,1.6*this.cameraMovement.distance,this.cameraMovement.distance),this.camera.lookAt(0,0,0),this.cameraMovement.xBoundary=this.mapSize.width/2,this.cameraMovement.zBoundary=this.mapSize.height/2}setupLights(){this.visionLight=new v.Ox3(16777215,.8),this.visionLight.position.set(100,400,200),this.visionLight.target.position.set(0,0,0),this.visionLight.castShadow=!0,this.visionLight.shadow.bias=-.001,this.visionLight.shadow.mapSize.width=4096,this.visionLight.shadow.mapSize.height=4096,this.visionLight.shadow.camera.near=1,this.visionLight.shadow.camera.far=1e3,this.visionLight.shadow.camera.fov=70,this.visionLight.shadow.camera.left=1e3,this.visionLight.shadow.camera.right=-1e3,this.visionLight.shadow.camera.top=1e3,this.visionLight.shadow.camera.bottom=-1e3,this.scene.add(this.visionLight);const e=new v.Mig(16777215,.5);this.scene.add(e)}setupFog(){this.scene.fog=new v.ybr(14674419,400,550)}setupRenderer(){this.renderer=new v.CP7({antialias:!1}),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=v._iA,this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setClearColor("#000"),this.renderer.shadowMap.enabled=!0,this.renderer.domElement.id="game-canvas",this.element.nativeElement.appendChild(this.renderer.domElement)}setupAnimationMixer(){}setupComposer(){this.composer=new z.xC(this.renderer),this.composer.addPass(new L.C(this.scene,this.camera)),this.outlinePass=new m.f(new v.FM8(window.innerWidth,window.innerHeight),this.scene,this.camera),this.composer.addPass(this.outlinePass),this.pixelPass=new h.T(b.g),this.pixelPass.uniforms.resolution.value=new v.FM8(window.innerWidth,window.innerHeight),this.pixelPass.uniforms.resolution.value.multiplyScalar(window.devicePixelRatio),this.pixelPass.uniforms.pixelSize.value=2,this.composer.addPass(this.pixelPass)}setupControls(){this.raycaster=new v.iMs,this.clickMouse=new v.FM8,this.moveMouse=new v.FM8}setupWorld(){this.createPlane(new v.Pa4(this.mapSize.width+1400,2,this.mapSize.height+1e3),new v.Pa4(0,-2,0),4473924),this.createPlane(new v.Pa4(this.mapSize.width,2,this.mapSize.height),new v.Pa4(0,-1,0),6728294),this.createCharacter(4,10,new v.Pa4(100*Math.random()-50,20,100*Math.random()-50),16777215*Math.random(),3),this.createBungalo(),this.createSign(),this.createUnitCube(new v.Pa4(10,0,0)),this.createUnitCube(new v.Pa4(10,0,-10)),this.createUnitCube(new v.Pa4(0,0,-10)),this.createNord(4,10,new v.Pa4(-10,0,0))}createUnitCube(e=new v.Pa4(0,0,0),n=new v.Pa4(5,5,5),i=0){var o=this;return(0,f.Z)(function*(){const l=yield(new k.L).loadAsync("assets/models/unit.obj"),u=(new v.dpR).load("assets/textures/placeholder_64.png");l.position.set(e.x,e.y,e.z),l.rotation.set(0,0,0),l.scale.set(n.x,n.y,n.z);const y=new o.Ammo.btTransform;y.setIdentity(),o.tmpVec.setValue(e.x,e.y+n.y,e.z),y.setOrigin(o.tmpVec),y.setRotation(new o.Ammo.btQuaternion(0,0,0,1));const _=new o.Ammo.btDefaultMotionState(y);o.tmpVec.setValue(n.x,n.y,n.z);const T=new o.Ammo.btBoxShape(o.tmpVec);T.setMargin(.05),o.tmpVec.setValue(0,0,0);const A=o.tmpVec;T.calculateLocalInertia(i,A);const D=new o.Ammo.btRigidBodyConstructionInfo(i,_,T,A),V=new o.Ammo.btRigidBody(D);V.setFriction(o.friction),V.setRollingFriction(o.rollingFriction),V.setActivationState(_e.DISABLE_DEACTIVATION),o.tmpVec.setValue(0,1,0),V.setAngularFactor(o.tmpVec),o.physicsWorld.addRigidBody(V,o.colGroupBall,o.colGroupBall|o.colGroupPlane),l.traverse(Z=>{Z instanceof v.Kj0&&(Z.userData.physicsBody=V,Z.userData.type="unit",Z.castShadow=!0,Z.receiveShadow=!0,Z.material.map=u)}),o.scene.add(l)})()}createSign(e=4,n=10,i=new v.Pa4(0,0,0),o=8026746,c=0){var a=this;return(0,f.Z)(function*(){const y=yield(new k.L).loadAsync("assets/models/sign.obj"),_=(new v.dpR).load("assets/textures/sign.png");y.position.set(i.x,i.y,i.z),y.rotation.set(0,Math.PI/180*0,0),y.scale.set(5,5,5);const T=new a.Ammo.btTransform;T.setIdentity(),a.tmpVec.setValue(i.x,i.y,i.z),T.setOrigin(a.tmpVec),T.setRotation(new a.Ammo.btQuaternion(0,0,0,1));const A=new a.Ammo.btDefaultMotionState(T);a.tmpVec.setValue(e,n,e);const D=new a.Ammo.btCylinderShape(a.tmpVec);D.setMargin(.05),a.tmpVec.setValue(0,0,0);const V=a.tmpVec;D.calculateLocalInertia(c,V);const Z=new a.Ammo.btRigidBodyConstructionInfo(c,A,D,V),re=new a.Ammo.btRigidBody(Z);re.setFriction(a.friction),re.setRollingFriction(a.rollingFriction),re.setActivationState(_e.DISABLE_DEACTIVATION),a.tmpVec.setValue(0,1,0),re.setAngularFactor(a.tmpVec),a.physicsWorld.addRigidBody(re,a.colGroupBall,a.colGroupBall|a.colGroupPlane),y.traverse(de=>{de instanceof v.Kj0&&(de.userData.physicsBody=re,de.userData.type="sign",de.userData.interactable=!0,de.castShadow=!0,de.receiveShadow=!0,de.material.map=_)}),a.scene.add(y)})()}createNord(e=4,n=10,i=new v.Pa4(0,0,0),o=8026746,c=0){var a=this;return(0,f.Z)(function*(){const y=yield(new H.E).loadAsync("assets/models/nord_animated.glb"),_=y.scene;_.scale.set(5,5,5);const T=(new v.dpR).load("assets/textures/nord.png");_.position.set(i.x,i.y,i.z),_.rotation.set(0,0,0);const A=new a.Ammo.btTransform;A.setIdentity(),a.tmpVec.setValue(i.x,i.y,i.z),A.setOrigin(a.tmpVec),A.setRotation(new a.Ammo.btQuaternion(0,0,0,1));const D=new a.Ammo.btDefaultMotionState(A);a.tmpVec.setValue(e,2*n,e);const V=new a.Ammo.btCylinderShape(a.tmpVec);V.setMargin(.05),a.tmpVec.setValue(0,0,0);const Z=a.tmpVec;V.calculateLocalInertia(c,Z);const re=new a.Ammo.btRigidBodyConstructionInfo(c,D,V,Z),de=new a.Ammo.btRigidBody(re);de.setFriction(a.friction),de.setRollingFriction(a.rollingFriction),de.setActivationState(_e.DISABLE_DEACTIVATION),a.tmpVec.setValue(0,1,0),de.setAngularFactor(a.tmpVec),a.physicsWorld.addRigidBody(de,a.colGroupBall,a.colGroupBall|a.colGroupPlane);const kt=new v.Xcj(_);_.traverse(be=>{be instanceof v.Kj0&&(be.userData.physicsBody=de,be.userData.type="sign",be.userData.interactable=!0,be.castShadow=!0,be.receiveShadow=!0,be.material.map=T)}),_.userData.mixer=kt,_.userData.mixer=kt,y.animations.forEach(be=>{kt.clipAction(be).play()}),a.scene.add(_)})()}createCharacter(e=4,n=10,i=new v.Pa4(100,5,0),o=8026746,c=1){const l=new v.Kj0(new v.fHI(e,e,n,20,20),new v.xoR({color:o}));l.position.set(i.x,i.y,i.z),l.castShadow=!0,l.receiveShadow=!0;const u=new this.Ammo.btTransform;u.setIdentity(),this.tmpVec.setValue(i.x,i.y,i.z),u.setOrigin(this.tmpVec),u.setRotation(new this.Ammo.btQuaternion(0,0,0,1));const y=new this.Ammo.btDefaultMotionState(u);this.tmpVec.setValue(e,n/2,e);const _=new this.Ammo.btCylinderShape(this.tmpVec);_.setMargin(.05),this.tmpVec.setValue(0,0,0);const T=this.tmpVec;_.calculateLocalInertia(c,T);const A=new this.Ammo.btRigidBodyConstructionInfo(c,y,_,T),D=new this.Ammo.btRigidBody(A);D.setFriction(this.friction),D.setRollingFriction(this.rollingFriction),D.setActivationState(_e.DISABLE_DEACTIVATION),this.tmpVec.setValue(0,1,0),D.setAngularFactor(this.tmpVec),this.physicsWorld.addRigidBody(D,this.colGroupBall,this.colGroupBall|this.colGroupPlane);const V=new g.z(l,D,{animationState:"idle",info:{color:o}},"Character");this.scene.add(V.model),this.characters.push(V),this.character=V}createPlayer(e=4,n=10,i=new v.Pa4(100,5,0),o=8026746,c=1){const l=new v.Kj0(new v.fHI(e,e,n,20,20),new v.xoR({color:o}));l.position.set(i.x,i.y,i.z),l.castShadow=!0,l.receiveShadow=!0;const u=new this.Ammo.btTransform;u.setIdentity(),this.tmpVec.setValue(i.x,i.y,i.z),u.setOrigin(this.tmpVec),u.setRotation(new this.Ammo.btQuaternion(0,0,0,1));const y=new this.Ammo.btDefaultMotionState(u);this.tmpVec.setValue(e,n/2,e);const _=new this.Ammo.btCylinderShape(this.tmpVec);_.setMargin(.05),this.tmpVec.setValue(0,0,0);const T=this.tmpVec;_.calculateLocalInertia(c,T);const A=new this.Ammo.btRigidBodyConstructionInfo(c,y,_,T),D=new this.Ammo.btRigidBody(A);D.setFriction(this.friction),D.setRollingFriction(this.rollingFriction),D.setActivationState(_e.DISABLE_DEACTIVATION),this.tmpVec.setValue(0,1,0),D.setAngularFactor(this.tmpVec),this.physicsWorld.addRigidBody(D,this.colGroupBall,this.colGroupBall|this.colGroupPlane);const V=new g.z(l,D,{animationState:"idle",info:{color:o}},"Character");this.scene.add(V.model),this.players.push(V)}createPlane(e=new v.Pa4(400,2,400),n=new v.Pa4(0,-1,0),i=8026746){const a=new v.Kj0(new v.nvb(1,1,1),new v.xoR({color:i})),l=(new v.dpR).load("assets/textures/placeholder_64.png");a.material.map=l,a.position.set(n.x,n.y,n.z),a.scale.set(e.x,e.y,e.z),a.castShadow=!0,a.receiveShadow=!0,this.scene.add(a);const u=new this.Ammo.btTransform;u.setIdentity(),this.tmpVec.setValue(n.x,n.y,n.z),u.setOrigin(this.tmpVec),u.setRotation(new this.Ammo.btQuaternion(0,0,0,1));const y=new this.Ammo.btDefaultMotionState(u);this.tmpVec.setValue(.5*e.x,.5*e.y,.5*e.z);const _=new this.Ammo.btBoxShape(this.tmpVec);_.setMargin(.05),this.tmpVec.setValue(0,0,0);const T=this.tmpVec;_.calculateLocalInertia(0,T);const A=new this.Ammo.btRigidBodyConstructionInfo(0,y,_,T),D=new this.Ammo.btRigidBody(A);D.setFriction(this.friction),D.setRollingFriction(this.rollingFriction),D.setActivationState(_e.DISABLE_DEACTIVATION),this.physicsWorld.addRigidBody(D,this.colGroupPlane,this.colGroupBall|this.colGroupPlayer),a.userData.physicsBody=D,a.userData.type="plane",D.threeObject=a,this.rigidBodies.push(a)}createBungalo(e=new v.Pa4(0,10,-100),n=65280){const o=new v.Wid({metalness:.1,roughness:1,color:13421772}),c=new v.YBo({color:n,emissive:n}),a=new v.Tme,l=new v.Kj0(new v.fHI(20,20,20,20,20),o);l.castShadow=!0,l.receiveShadow=!0,a.add(l);const u=new v.Kj0(new v.fHI(20,20,4,20,20),c);u.position.set(0,12,0),u.castShadow=!0,u.receiveShadow=!0,a.add(u);const y=new v.Kj0(new v.fHI(0,22,10,8,8),o);y.position.set(0,19,0),y.castShadow=!0,y.receiveShadow=!0,a.add(y),a.position.set(e.x,e.y,e.z),a.position.set(e.x,e.y,e.z),a.castShadow=!0,a.receiveShadow=!0,this.scene.add(a);const T=new this.Ammo.btTransform;T.setIdentity(),this.tmpVec.setValue(e.x,e.y,e.z),T.setOrigin(this.tmpVec),T.setRotation(new this.Ammo.btQuaternion(0,0,0,1));const A=new this.Ammo.btDefaultMotionState(T);this.tmpVec.setValue(20,17,20);const D=new this.Ammo.btCylinderShape(this.tmpVec);D.setMargin(.05),this.tmpVec.setValue(0,0,0);const V=this.tmpVec;D.calculateLocalInertia(0,V);const Z=new this.Ammo.btRigidBodyConstructionInfo(0,A,D,V),re=new this.Ammo.btRigidBody(Z);re.setFriction(this.friction),re.setRollingFriction(this.rollingFriction),re.setActivationState(_e.DISABLE_DEACTIVATION),this.physicsWorld.addRigidBody(re,this.colGroupBall,this.colGroupBall|this.colGroupPlane),a.userData.physicsBody=re,a.userData.type="bungalo",l.userData=a.userData,u.userData=a.userData,y.userData=a.userData,re.threeObject=a,this.rigidBodies.push(a)}update(){const e=this.clock.getDelta();if(this.moveCharacter(this.character),this.players[0]&&this.moveCharacter(this.players[0]),this.updatePhysics(e),this.updateCamera(),this.scene.traverse(n=>{n.userData.mixer&&n.userData.mixer.update(e)}),this.showInteractables){this.outlinePass.selectedObjects=[];for(let n of this.scene.children)this.getDistance(n.position,this.character.model.position)>400||n instanceof v.ZAu&&n.children[0]&&("Armature"===n.children[0].name?n.children[0].children.forEach(i=>{i.userData.interactable&&this.outlinePass.selectedObjects.push(n)}):n.children[0].userData.interactable&&this.outlinePass.selectedObjects.push(n))}this.render(),requestAnimationFrame(()=>this.update())}updateCamera(){this.camera.position.setX(this.character.model.position.x),this.camera.position.setZ(this.character.model.position.z+.8*this.cameraMovement.distance),this.camera.position.setY(this.cameraMovement.distance<80?this.cameraMovement.distance:this.cameraMovement.distance<100?1.2*this.cameraMovement.distance:this.cameraMovement.distance<120?1.4*this.cameraMovement.distance:1.6*this.cameraMovement.distance),this.pixelPass.uniforms.pixelSize.value=4,this.camera.lookAt(this.character.model.position.x,.8*-this.cameraMovement.distance,this.character.model.position.z-this.cameraMovement.distance),this.cameraMovement.distanceChange=0}updatePhysics(e){this.physicsWorld.stepSimulation(e,10);for(let n=0;n<this.rigidBodies.length;n++){const i=this.rigidBodies[n],c=i.userData.physicsBody.getMotionState();if(c){c.getWorldTransform(this.tmpTrans);const a=this.tmpTrans.getOrigin(),l=this.tmpTrans.getRotation();i.position.set(a.x(),a.y(),a.z()),i.quaternion.set(l.x(),l.y(),l.z(),l.w())}i.position.x<-1*this.cameraMovement.xBoundary&&setTimeout(()=>{this.rigidBodies.splice(n,1),this.scene.remove(i)},1e3),i.position.x>this.cameraMovement.xBoundary&&setTimeout(()=>{this.rigidBodies.splice(n,1),this.scene.remove(i)},1e3),i.position.z<-1*this.cameraMovement.zBoundary&&setTimeout(()=>{this.rigidBodies.splice(n,1),this.scene.remove(i)},1e3),i.position.z>this.cameraMovement.zBoundary&&setTimeout(()=>{this.rigidBodies.splice(n,1),this.scene.remove(i)},1e3)}for(let n=0;n<this.characters.length;n++){const i=this.characters[n],o=i.model,a=i.physicsBody.getMotionState();if(a){a.getWorldTransform(this.tmpTrans);const l=this.tmpTrans.getOrigin(),u=this.tmpTrans.getRotation();o.position.set(l.x(),l.y(),l.z()),o.quaternion.set(u.x(),u.y(),u.z(),u.w())}}for(let n=0;n<this.players.length;n++){const i=this.players[n],o=i.model,a=i.physicsBody.getMotionState();if(a){a.getWorldTransform(this.tmpTrans);const l=this.tmpTrans.getOrigin(),u=this.tmpTrans.getRotation();o.position.set(l.x(),l.y(),l.z()),o.quaternion.set(u.x(),u.y(),u.z(),u.w())}}this.detectCollision()}detectCollision(){const e=this.physicsWorld.getDispatcher(),n=e.getNumManifolds();for(let i=0;i<n;i++){const o=e.getManifoldByIndexInternal(i),c=this.Ammo.castObject(o.getBody0(),j().btRigidBody),a=this.Ammo.castObject(o.getBody1(),j().btRigidBody),l=c.threeObject,u=a.threeObject;if(!l&&!u)continue;const y=l?l.userData:null,_=u?u.userData:null,T=y?y.type:"none",A=_?_.type:"none";if("plane"==T||"plane"==A)continue;console.log("COLLISION",T,A);const D=o.getNumContacts();for(let V=0;V<D;V++){const Z=o.getContactPoint(V),re=Z.getDistance();re>.01||re<-.01||(c.getLinearVelocity(),a.getLinearVelocity(),Z.get_m_positionWorldOnA(),Z.get_m_positionWorldOnB(),Z.get_m_localPointA(),Z.get_m_localPointB())}}}render(){this.pixelate||(this.pixelPass.uniforms.pixelSize.value=1),this.composer.render()}getCursorPosition(e){const n=new v.Pa4,i=new v.Pa4;n.set(e.clientX/window.innerWidth*2-1,-e.clientY/window.innerHeight*2+1,.5),n.unproject(this.camera),n.sub(this.camera.position).normalize();const o=-this.camera.position.y/n.y;return i.copy(this.camera.position).add(n.multiplyScalar(o)),i}onResize(){this.renderer.setSize(window.innerWidth,window.innerHeight),this.pixelPass.uniforms.resolution.value.set(window.innerWidth,window.innerHeight).multiplyScalar(window.devicePixelRatio),this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix()}relocate(e,n={x:0,y:0,z:0},i={x:0,y:0,z:0}){this.physicsWorld.removeRigidBody(e),this.tmpVec.setValue(0,0,0),e.setLinearVelocity(this.tmpVec),e.setAngularVelocity(this.tmpVec);const o=e.getWorldTransform();this.tmpVec.setValue(n.x,n.y,n.z);const c=new this.Ammo.btQuaternion(i.x,i.y,i.z,1);o.setOrigin(this.tmpVec),o.setRotation(c),e.setWorldTransform(o),this.physicsWorld.addRigidBody(e)}moveThere(e,n={x:0,y:0,z:0},i=2){e.animation="move",e.info=e.info||{},e.info.move=!0,e.info.targetPosition={x:n.x,z:n.z},this.sendAction({type:"move",targetPosition:{x:n.x,z:n.z}}),e.info.moveAcceptanceRange=i}moveCharacter(e){var n;if(!(null===(n=null==e?void 0:e.info)||void 0===n?void 0:n.move))return;e.physicsBody.setFriction(0),e.physicsBody.setRollingFriction(0),this.tmpVec.setX(e.physicsBody.getLinearVelocity().x()),this.tmpVec.setY(e.physicsBody.getLinearVelocity().y()),this.tmpVec.setZ(e.physicsBody.getLinearVelocity().z());const i=e.info.targetPosition.x-e.model.position.x,o=e.info.targetPosition.z-e.model.position.z,c=(Math.abs(i)>Math.abs(o)?Math.abs(i):Math.abs(o))/80,a=e.info.moveAcceptanceRange||4,l=this.getDistance(e.info.targetPosition,e.model.position);l<a?(e.physicsBody.setFriction(this.friction),e.physicsBody.setRollingFriction(this.rollingFriction),e.info.move=!1,e.info.targetPosition=void 0,e.info.moveAcceptanceRange=void 0,this.tmpVec.setX(0),this.tmpVec.setZ(0),e.info.runWhenStopped&&(e.info.runWhenStopped(),e.info.runWhenStopped=void 0)):l>a+1?(this.tmpVec.setX(i/c),this.tmpVec.setZ(o/c)):(this.tmpVec.setX(i/(2*c)),this.tmpVec.setZ(o/(2*c))),e.physicsBody.setLinearVelocity(this.tmpVec)}getDistance(e,n){return Math.sqrt(Math.pow(Math.abs(e.x-n.x),2)+Math.pow(Math.abs(e.z-n.z),2))}onClick(e){switch(this.character.info.runWhenStopped=void 0,e.which){case 1:this.clickMouse.setX(e.clientX/window.innerWidth*2-1),this.clickMouse.setY(e.clientY/window.innerHeight*-2+1),this.raycaster.setFromCamera(this.clickMouse,this.camera);const n=this.raycaster.intersectObjects(this.scene.children)[0].object;switch(this.selectedObject&&"Character"===this.selectedObject.type&&(this.tmpVec.setValue(0,0,0),this.selectedObject.object.info.move=!1,this.selectedObject.object.info.targetPosition=void 0,this.selectedObject.object.physicsBody.setLinearVelocity(this.tmpVec),this.selectedObject.object.physicsBody.setFriction(this.friction),this.selectedObject.object.physicsBody.setRollingFriction(this.rollingFriction)),this.selectedObject=n.userData,this.selectedObject.type){case"bungalo":Math.random()>.5?this.soundService.sound("nord/no_1.mp3"):this.soundService.sound("nord/no_2.mp3");break;case"Character":Math.random()>.5?this.soundService.sound("nord/select_1.mp3"):this.soundService.sound("nord/select_2.mp3");break;case"sign":if(Math.random()>.5?this.soundService.sound("nord/yes_1.mp3"):this.soundService.sound("nord/yes_2.mp3"),this.getDistance(n.position,this.character.model.position)<20){let _;_=this.selectedObject.broken?(new v.dpR).load("assets/textures/sign.png"):(new v.dpR).load("assets/textures/sign_broken.png"),this.selectedObject.broken=!this.selectedObject.broken,setTimeout(()=>{n.material.map=_,this.soundService.sound("click.wav")},5)}else this.moveThere(this.character,n.position,18),this.character.info.runWhenStopped=()=>{let _;_=this.selectedObject.broken?(new v.dpR).load("assets/textures/sign.png"):(new v.dpR).load("assets/textures/sign_broken.png"),this.selectedObject.broken=!this.selectedObject.broken,setTimeout(()=>{n.material.map=_,this.soundService.sound("click.wav")},5)};break;default:this.clickMouse.setX(e.clientX/window.innerWidth*2-1),this.clickMouse.setY(e.clientY/window.innerHeight*-2+1),this.raycaster.setFromCamera(this.clickMouse,this.camera);const l=new v.Pa4,u=new v.Pa4;l.set(e.clientX/window.innerWidth*2-1,-e.clientY/window.innerHeight*2+1,.5),l.unproject(this.camera),l.sub(this.camera.position).normalize();const y=-this.camera.position.y/l.y;u.copy(this.camera.position).add(l.multiplyScalar(y)),u.setY(5),this.moveThere(this.character,u)}break;case 2:this.cameraMovement.dragOrigin||(this.cameraMovement.dragOrigin=this.getCursorPosition(e),this.cameraMovement.dragOriginCameraPositon=this.camera.position);break;case 3:this.clickMouse.setX(e.clientX/window.innerWidth*2-1),this.clickMouse.setY(e.clientY/window.innerHeight*-2+1),this.raycaster.setFromCamera(this.clickMouse,this.camera);const i=new v.Pa4,o=new v.Pa4;i.set(e.clientX/window.innerWidth*2-1,-e.clientY/window.innerHeight*2+1,.5),i.unproject(this.camera),i.sub(this.camera.position).normalize();const c=-this.camera.position.y/i.y;o.copy(this.camera.position).add(i.multiplyScalar(c)),o.setY(5),this.moveThere(this.character,o)}}onClickEnd(e){switch(e.which){case 1:case 3:break;case 2:this.cameraMovement.dragOrigin=null,this.cameraMovement.dragX=0,this.cameraMovement.dragZ=0}}onMouseMove(e){if(!this.moveMouse||!this.raycaster)return;this.moveMouse.setX(e.clientX/window.innerWidth*2-1),this.moveMouse.setY(e.clientY/window.innerHeight*-2+1),this.raycaster.setFromCamera(this.moveMouse,this.camera);const n=this.raycaster.intersectObjects(this.scene.children)[0].object;this.outlinePass.selectedObjects=n&&n.userData.interactable?[n]:[]}onScroll(e){e.wheelDelta>0&&this.cameraMovement.distance>60?(this.cameraMovement.distance-=10,this.cameraMovement.distanceChange-=10):e.wheelDelta<0&&this.cameraMovement.distance<80&&(this.cameraMovement.distance+=10,this.cameraMovement.distanceChange+=10)}onKeyDown(e){if(this.lastKey!==e.key)switch(this.lastKey=e.key,e.key){case"Alt":e.preventDefault(),this.showInteractables=!this.showInteractables,this.showInteractables||(this.outlinePass.selectedObjects=[]);break;case"Tab":e.preventDefault(),this.cameraMovement.distance=140}}onKeyUp(e){switch(this.lastKey=void 0,e.key){case"Alt":break;case"Shift":this.cameraMovement.shift=1}}}return t.\u0275fac=function(e){return new(e||t)(s.Y36(E.y),s.Y36(B.p),s.Y36(mi),s.Y36(gi.k),s.Y36(s.SBq))},t.\u0275cmp=s.Xpm({type:t,selectors:[["smitd-game-screen"]],hostBindings:function(e,n){1&e&&s.NdJ("resize",function(o){return n.onResize(o)},!1,s.Jf7)("mousedown",function(o){return n.onClick(o)})("mouseup",function(o){return n.onClickEnd(o)})("mousemove",function(o){return n.onMouseMove(o)})("wheel",function(o){return n.onScroll(o)})("keydown",function(o){return n.onKeyDown(o)},!1,s.evT)("keyup",function(o){return n.onKeyUp(o)},!1,s.evT)},decls:23,vars:4,consts:[["top",""],[1,"peer"],[1,"select-all-text"],["type","text"],["hostPeerId",""],["mat-raised-button","","smitd-click-sound","","color","primary",3,"click"],["bottom",""],["mat-raised-button","","smitd-click-sound","","color","primary"],[1,"canvas-container"],["canvasContainer",""]],template:function(e,n){if(1&e){const i=s.EpF();s.TgZ(0,"smitd-game-hud"),s.ynx(1,0),s.TgZ(2,"h2"),s._uU(3," Catchy Version "),s.TgZ(4,"span"),s._uU(5),s.ALo(6,"translate"),s.qZA()(),s.TgZ(7,"div",1)(8,"p"),s._uU(9,"peerID: "),s.TgZ(10,"span",2),s._uU(11),s.qZA()(),s.TgZ(12,"span"),s._uU(13,"|"),s.qZA(),s._UZ(14,"input",3,4),s.TgZ(16,"button",5),s.NdJ("click",function(){s.CHM(i);const c=s.MAs(15);return n.connectToHost(c.value)}),s._uU(17,"join"),s.qZA()(),s.BQk(),s.ynx(18,6),s.TgZ(19,"button",7),s._uU(20,"bottom"),s.qZA(),s.BQk(),s.qZA(),s._UZ(21,"div",8,9)}2&e&&(s.xp6(5),s.Oqu(s.lcZ(6,2,"lang")),s.xp6(6),s.Oqu(n.myPeerId))},directives:[_i,Ci.lW,bi.O],pipes:[Lr.X$],styles:[".canvas-container[_ngcontent-%COMP%]{position:absolute;top:40px;left:0;right:0;bottom:80px}.peer[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.peer[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.select-all-text[_ngcontent-%COMP%]{user-select:all;-moz-user-select:all;-webkit-user-select:all}"]}),t})()}];let Ti=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=s.oAB({type:t}),t.\u0275inj=s.cJS({imports:[[X.Bz.forChild(Si)],X.Bz]}),t})();var ki=d(3226);d(2076),d(4128),d(4004);let An=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=s.oAB({type:t}),t.\u0275inj=s.cJS({}),t})();const Qt=new s.OlP("NgModelWithFormControlWarning");let Jn=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=s.oAB({type:t}),t.\u0275inj=s.cJS({imports:[[An]]}),t})(),Po=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=s.oAB({type:t}),t.\u0275inj=s.cJS({imports:[Jn]}),t})(),Ro=(()=>{class t{static withConfig(e){return{ngModule:t,providers:[{provide:Qt,useValue:e.warnOnNgModelWithFormControl}]}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=s.oAB({type:t}),t.\u0275inj=s.cJS({imports:[Jn]}),t})(),Mo=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=s.oAB({type:t}),t.\u0275inj=s.cJS({imports:[[q.ez,Ti,ki.m,Po,Ro]]}),t})()},8819:(fe,S,d)=>{var p=d(3417).MY,C=d(3417).cx;function P(f){this.index=0,this.dataBuffer=f,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}function F(){this.bufferBuilder=new p}function q(f){var g=f.charCodeAt(0);return g<=2047?"00":g<=65535?"000":g<=2097151?"0000":g<=67108863?"00000":"000000"}fe.exports={unpack:function(f){return new P(f).unpack()},pack:function(f){var g=new F;return g.pack(f),g.getBuffer()}},P.prototype.unpack=function(){var g,f=this.unpack_uint8();if(f<128)return f;if((224^f)<32)return(224^f)-32;if((g=160^f)<=15)return this.unpack_raw(g);if((g=176^f)<=15)return this.unpack_string(g);if((g=144^f)<=15)return this.unpack_array(g);if((g=128^f)<=15)return this.unpack_map(g);switch(f){case 192:return null;case 193:case 212:case 213:case 214:case 215:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 216:return g=this.unpack_uint16(),this.unpack_string(g);case 217:return g=this.unpack_uint32(),this.unpack_string(g);case 218:return g=this.unpack_uint16(),this.unpack_raw(g);case 219:return g=this.unpack_uint32(),this.unpack_raw(g);case 220:return g=this.unpack_uint16(),this.unpack_array(g);case 221:return g=this.unpack_uint32(),this.unpack_array(g);case 222:return g=this.unpack_uint16(),this.unpack_map(g);case 223:return g=this.unpack_uint32(),this.unpack_map(g)}},P.prototype.unpack_uint8=function(){var f=255&this.dataView[this.index];return this.index++,f},P.prototype.unpack_uint16=function(){var f=this.read(2),g=256*(255&f[0])+(255&f[1]);return this.index+=2,g},P.prototype.unpack_uint32=function(){var f=this.read(4),g=256*(256*(256*f[0]+f[1])+f[2])+f[3];return this.index+=4,g},P.prototype.unpack_uint64=function(){var f=this.read(8),g=256*(256*(256*(256*(256*(256*(256*f[0]+f[1])+f[2])+f[3])+f[4])+f[5])+f[6])+f[7];return this.index+=8,g},P.prototype.unpack_int8=function(){var f=this.unpack_uint8();return f<128?f:f-256},P.prototype.unpack_int16=function(){var f=this.unpack_uint16();return f<32768?f:f-65536},P.prototype.unpack_int32=function(){var f=this.unpack_uint32();return f<Math.pow(2,31)?f:f-Math.pow(2,32)},P.prototype.unpack_int64=function(){var f=this.unpack_uint64();return f<Math.pow(2,63)?f:f-Math.pow(2,64)},P.prototype.unpack_raw=function(f){if(this.length<this.index+f)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+f+" "+this.length);var g=this.dataBuffer.slice(this.index,this.index+f);return this.index+=f,g},P.prototype.unpack_string=function(f){for(var j,H,g=this.read(f),v=0,w="";v<f;)(j=g[v])<128?(w+=String.fromCharCode(j),v++):(192^j)<32?(H=(192^j)<<6|63&g[v+1],w+=String.fromCharCode(H),v+=2):(H=(15&j)<<12|(63&g[v+1])<<6|63&g[v+2],w+=String.fromCharCode(H),v+=3);return this.index+=f,w},P.prototype.unpack_array=function(f){for(var g=new Array(f),v=0;v<f;v++)g[v]=this.unpack();return g},P.prototype.unpack_map=function(f){for(var g={},v=0;v<f;v++){var w=this.unpack(),j=this.unpack();g[w]=j}return g},P.prototype.unpack_float=function(){var f=this.unpack_uint32();return(0==f>>31?1:-1)*(8388607&f|8388608)*Math.pow(2,(f>>23&255)-127-23)},P.prototype.unpack_double=function(){var f=this.unpack_uint32(),g=this.unpack_uint32(),w=(f>>20&2047)-1023;return(0==f>>31?1:-1)*((1048575&f|1048576)*Math.pow(2,w-20)+g*Math.pow(2,w-52))},P.prototype.read=function(f){var g=this.index;if(g+f<=this.length)return this.dataView.subarray(g,g+f);throw new Error("BinaryPackFailure: read index out of range")},F.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()},F.prototype.pack=function(f){var g=typeof f;if("string"===g)this.pack_string(f);else if("number"===g)Math.floor(f)===f?this.pack_integer(f):this.pack_double(f);else if("boolean"===g)!0===f?this.bufferBuilder.append(195):!1===f&&this.bufferBuilder.append(194);else if("undefined"===g)this.bufferBuilder.append(192);else{if("object"!==g)throw new Error('Type "'+g+'" not yet supported');if(null===f)this.bufferBuilder.append(192);else{var v=f.constructor;if(v==Array)this.pack_array(f);else if(v==Blob||v==File||f instanceof Blob||f instanceof File)this.pack_bin(f);else if(v==ArrayBuffer)this.pack_bin(C.useArrayBufferView?new Uint8Array(f):f);else if("BYTES_PER_ELEMENT"in f)this.pack_bin(C.useArrayBufferView?new Uint8Array(f.buffer):f.buffer);else if(v==Object||v.toString().startsWith("class"))this.pack_object(f);else if(v==Date)this.pack_string(f.toString());else{if("function"!=typeof f.toBinaryPack)throw new Error('Type "'+v.toString()+'" not yet supported');this.bufferBuilder.append(f.toBinaryPack())}}}this.bufferBuilder.flush()},F.prototype.pack_bin=function(f){var g=f.length||f.byteLength||f.size;if(g<=15)this.pack_uint8(160+g);else if(g<=65535)this.bufferBuilder.append(218),this.pack_uint16(g);else{if(!(g<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(219),this.pack_uint32(g)}this.bufferBuilder.append(f)},F.prototype.pack_string=function(f){var g=function X(f){return f.length>600?new Blob([f]).size:f.replace(/[^\u0000-\u007F]/g,q).length}(f);if(g<=15)this.pack_uint8(176+g);else if(g<=65535)this.bufferBuilder.append(216),this.pack_uint16(g);else{if(!(g<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(217),this.pack_uint32(g)}this.bufferBuilder.append(f)},F.prototype.pack_array=function(f){var g=f.length;if(g<=15)this.pack_uint8(144+g);else if(g<=65535)this.bufferBuilder.append(220),this.pack_uint16(g);else{if(!(g<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(221),this.pack_uint32(g)}for(var v=0;v<g;v++)this.pack(f[v])},F.prototype.pack_integer=function(f){if(f>=-32&&f<=127)this.bufferBuilder.append(255&f);else if(f>=0&&f<=255)this.bufferBuilder.append(204),this.pack_uint8(f);else if(f>=-128&&f<=127)this.bufferBuilder.append(208),this.pack_int8(f);else if(f>=0&&f<=65535)this.bufferBuilder.append(205),this.pack_uint16(f);else if(f>=-32768&&f<=32767)this.bufferBuilder.append(209),this.pack_int16(f);else if(f>=0&&f<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(f);else if(f>=-2147483648&&f<=2147483647)this.bufferBuilder.append(210),this.pack_int32(f);else if(f>=-0x8000000000000000&&f<=0x8000000000000000)this.bufferBuilder.append(211),this.pack_int64(f);else{if(!(f>=0&&f<=0x10000000000000000))throw new Error("Invalid integer");this.bufferBuilder.append(207),this.pack_uint64(f)}},F.prototype.pack_double=function(f){var g=0;f<0&&(g=1,f=-f);var v=Math.floor(Math.log(f)/Math.LN2),w=f/Math.pow(2,v)-1,j=Math.floor(w*Math.pow(2,52)),H=Math.pow(2,32),k=g<<31|v+1023<<20|j/H&1048575,z=j%H;this.bufferBuilder.append(203),this.pack_int32(k),this.pack_int32(z)},F.prototype.pack_object=function(f){var v=Object.keys(f).length;if(v<=15)this.pack_uint8(128+v);else if(v<=65535)this.bufferBuilder.append(222),this.pack_uint16(v);else{if(!(v<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(223),this.pack_uint32(v)}for(var w in f)f.hasOwnProperty(w)&&(this.pack(w),this.pack(f[w]))},F.prototype.pack_uint8=function(f){this.bufferBuilder.append(f)},F.prototype.pack_uint16=function(f){this.bufferBuilder.append(f>>8),this.bufferBuilder.append(255&f)},F.prototype.pack_uint32=function(f){var g=4294967295&f;this.bufferBuilder.append((4278190080&g)>>>24),this.bufferBuilder.append((16711680&g)>>>16),this.bufferBuilder.append((65280&g)>>>8),this.bufferBuilder.append(255&g)},F.prototype.pack_uint64=function(f){var g=f/Math.pow(2,32),v=f%Math.pow(2,32);this.bufferBuilder.append((4278190080&g)>>>24),this.bufferBuilder.append((16711680&g)>>>16),this.bufferBuilder.append((65280&g)>>>8),this.bufferBuilder.append(255&g),this.bufferBuilder.append((4278190080&v)>>>24),this.bufferBuilder.append((16711680&v)>>>16),this.bufferBuilder.append((65280&v)>>>8),this.bufferBuilder.append(255&v)},F.prototype.pack_int8=function(f){this.bufferBuilder.append(255&f)},F.prototype.pack_int16=function(f){this.bufferBuilder.append((65280&f)>>8),this.bufferBuilder.append(255&f)},F.prototype.pack_int32=function(f){this.bufferBuilder.append(f>>>24&255),this.bufferBuilder.append((16711680&f)>>>16),this.bufferBuilder.append((65280&f)>>>8),this.bufferBuilder.append(255&f)},F.prototype.pack_int64=function(f){var g=Math.floor(f/Math.pow(2,32)),v=f%Math.pow(2,32);this.bufferBuilder.append((4278190080&g)>>>24),this.bufferBuilder.append((16711680&g)>>>16),this.bufferBuilder.append((65280&g)>>>8),this.bufferBuilder.append(255&g),this.bufferBuilder.append((4278190080&v)>>>24),this.bufferBuilder.append((16711680&v)>>>16),this.bufferBuilder.append((65280&v)>>>8),this.bufferBuilder.append(255&v)}},3417:fe=>{var S={};S.useBlobBuilder=function(){try{return new Blob([]),!1}catch(C){return!0}}(),S.useArrayBufferView=!S.useBlobBuilder&&function(){try{return 0===new Blob([new Uint8Array([])]).size}catch(C){return!0}}(),fe.exports.cx=S;var d=fe.exports.xE;function p(){this._pieces=[],this._parts=[]}"undefined"!=typeof window&&(d=fe.exports.xE=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder),p.prototype.append=function(C){"number"==typeof C?this._pieces.push(C):(this.flush(),this._parts.push(C))},p.prototype.flush=function(){if(this._pieces.length>0){var C=new Uint8Array(this._pieces);S.useArrayBufferView||(C=C.buffer),this._parts.push(C),this._pieces=[]}},p.prototype.getBuffer=function(){if(this.flush(),S.useBlobBuilder){for(var C=new d,x=0,P=this._parts.length;x<P;x++)C.append(this._parts[x]);return C.getBlob()}return new Blob(this._parts)},fe.exports.MY=p},6334:(fe,S,d)=>{"use strict";var p=d(7463);function x(g,v,w,j,H){var k=p.writeRtpDescription(g.kind,v);if(k+=p.writeIceParameters(g.iceGatherer.getLocalParameters()),k+=p.writeDtlsParameters(g.dtlsTransport.getLocalParameters(),"offer"===w?"actpass":H||"active"),k+="a=mid:"+g.mid+"\r\n",k+=g.rtpSender&&g.rtpReceiver?"a=sendrecv\r\n":g.rtpSender?"a=sendonly\r\n":g.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",g.rtpSender){var z=g.rtpSender._initialTrackId||g.rtpSender.track.id;g.rtpSender._initialTrackId=z;var L="msid:"+(j?j.id:"-")+" "+z+"\r\n";k+="a="+L,k+="a=ssrc:"+g.sendEncodingParameters[0].ssrc+" "+L,g.sendEncodingParameters[0].rtx&&(k+="a=ssrc:"+g.sendEncodingParameters[0].rtx.ssrc+" "+L,k+="a=ssrc-group:FID "+g.sendEncodingParameters[0].ssrc+" "+g.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return k+="a=ssrc:"+g.sendEncodingParameters[0].ssrc+" cname:"+p.localCName+"\r\n",g.rtpSender&&g.sendEncodingParameters[0].rtx&&(k+="a=ssrc:"+g.sendEncodingParameters[0].rtx.ssrc+" cname:"+p.localCName+"\r\n"),k}function F(g,v){var w={codecs:[],headerExtensions:[],fecMechanisms:[]},j=function(k,z){k=parseInt(k,10);for(var L=0;L<z.length;L++)if(z[L].payloadType===k||z[L].preferredPayloadType===k)return z[L]},H=function(k,z,L,h){var m=j(k.parameters.apt,L),b=j(z.parameters.apt,h);return m&&b&&m.name.toLowerCase()===b.name.toLowerCase()};return g.codecs.forEach(function(k){for(var z=0;z<v.codecs.length;z++){var L=v.codecs[z];if(k.name.toLowerCase()===L.name.toLowerCase()&&k.clockRate===L.clockRate){if("rtx"===k.name.toLowerCase()&&k.parameters&&L.parameters.apt&&!H(k,L,g.codecs,v.codecs))continue;(L=JSON.parse(JSON.stringify(L))).numChannels=Math.min(k.numChannels,L.numChannels),w.codecs.push(L),L.rtcpFeedback=L.rtcpFeedback.filter(function(h){for(var m=0;m<k.rtcpFeedback.length;m++)if(k.rtcpFeedback[m].type===h.type&&k.rtcpFeedback[m].parameter===h.parameter)return!0;return!1});break}}}),g.headerExtensions.forEach(function(k){for(var z=0;z<v.headerExtensions.length;z++){var L=v.headerExtensions[z];if(k.uri===L.uri){w.headerExtensions.push(L);break}}}),w}function q(g,v,w){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[v][g].indexOf(w)}function X(g,v){var w=g.getRemoteCandidates().find(function(j){return v.foundation===j.foundation&&v.ip===j.ip&&v.port===j.port&&v.priority===j.priority&&v.protocol===j.protocol&&v.type===j.type});return w||g.addRemoteCandidate(v),!w}function f(g,v){var w=new Error(v);return w.name=g,w.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[g],w}fe.exports=function(g,v){function w(h,m){m.addTrack(h),m.dispatchEvent(new g.MediaStreamTrackEvent("addtrack",{track:h}))}function H(h,m,b,s){var E=new Event("track");E.track=m,E.receiver=b,E.transceiver={receiver:b},E.streams=s,g.setTimeout(function(){h._dispatchEvent("track",E)})}var k=function(h){var m=this,b=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(E){m[E]=b[E].bind(b)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",h=JSON.parse(JSON.stringify(h||{})),this.usingBundle="max-bundle"===h.bundlePolicy,"negotiate"===h.rtcpMuxPolicy)throw f("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(h.rtcpMuxPolicy||(h.rtcpMuxPolicy="require"),h.iceTransportPolicy){case"all":case"relay":break;default:h.iceTransportPolicy="all"}switch(h.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:h.bundlePolicy="balanced"}if(h.iceServers=function P(g,v){var w=!1;return(g=JSON.parse(JSON.stringify(g))).filter(function(j){if(j&&(j.urls||j.url)){var H=j.urls||j.url;j.url&&!j.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var k="string"==typeof H;return k&&(H=[H]),H=H.filter(function(z){return 0!==z.indexOf("turn:")||-1===z.indexOf("transport=udp")||-1!==z.indexOf("turn:[")||w?0===z.indexOf("stun:")&&v>=14393&&-1===z.indexOf("?transport=udp"):(w=!0,!0)}),delete j.url,j.urls=k?H[0]:H,!!H.length}})}(h.iceServers||[],v),this._iceGatherers=[],h.iceCandidatePoolSize)for(var s=h.iceCandidatePoolSize;s>0;s--)this._iceGatherers.push(new g.RTCIceGatherer({iceServers:h.iceServers,gatherPolicy:h.iceTransportPolicy}));else h.iceCandidatePoolSize=0;this._config=h,this.transceivers=[],this._sdpSessionId=p.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(k.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(k.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),k.prototype.onicecandidate=null,k.prototype.onaddstream=null,k.prototype.ontrack=null,k.prototype.onremovestream=null,k.prototype.onsignalingstatechange=null,k.prototype.oniceconnectionstatechange=null,k.prototype.onconnectionstatechange=null,k.prototype.onicegatheringstatechange=null,k.prototype.onnegotiationneeded=null,k.prototype.ondatachannel=null,k.prototype._dispatchEvent=function(h,m){this._isClosed||(this.dispatchEvent(m),"function"==typeof this["on"+h]&&this["on"+h](m))},k.prototype._emitGatheringStateChange=function(){var h=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",h)},k.prototype.getConfiguration=function(){return this._config},k.prototype.getLocalStreams=function(){return this.localStreams},k.prototype.getRemoteStreams=function(){return this.remoteStreams},k.prototype._createTransceiver=function(h,m){var s={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:h,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&this.transceivers.length>0)s.iceTransport=this.transceivers[0].iceTransport,s.dtlsTransport=this.transceivers[0].dtlsTransport;else{var E=this._createIceAndDtlsTransports();s.iceTransport=E.iceTransport,s.dtlsTransport=E.dtlsTransport}return m||this.transceivers.push(s),s},k.prototype.addTrack=function(h,m){if(this._isClosed)throw f("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");if(this.transceivers.find(function(B){return B.track===h}))throw f("InvalidAccessError","Track already exists.");for(var s,E=0;E<this.transceivers.length;E++)!this.transceivers[E].track&&this.transceivers[E].kind===h.kind&&(s=this.transceivers[E]);return s||(s=this._createTransceiver(h.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(m)&&this.localStreams.push(m),s.track=h,s.stream=m,s.rtpSender=new g.RTCRtpSender(h,s.dtlsTransport),s.rtpSender},k.prototype.addStream=function(h){var m=this;if(v>=15025)h.getTracks().forEach(function(s){m.addTrack(s,h)});else{var b=h.clone();h.getTracks().forEach(function(s,E){var B=b.getTracks()[E];s.addEventListener("enabled",function(R){B.enabled=R.enabled})}),b.getTracks().forEach(function(s){m.addTrack(s,b)})}},k.prototype.removeTrack=function(h){if(this._isClosed)throw f("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(h instanceof g.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var m=this.transceivers.find(function(E){return E.rtpSender===h});if(!m)throw f("InvalidAccessError","Sender was not created by this connection.");var b=m.stream;m.rtpSender.stop(),m.rtpSender=null,m.track=null,m.stream=null,-1===this.transceivers.map(function(E){return E.stream}).indexOf(b)&&this.localStreams.indexOf(b)>-1&&this.localStreams.splice(this.localStreams.indexOf(b),1),this._maybeFireNegotiationNeeded()},k.prototype.removeStream=function(h){var m=this;h.getTracks().forEach(function(b){var s=m.getSenders().find(function(E){return E.track===b});s&&m.removeTrack(s)})},k.prototype.getSenders=function(){return this.transceivers.filter(function(h){return!!h.rtpSender}).map(function(h){return h.rtpSender})},k.prototype.getReceivers=function(){return this.transceivers.filter(function(h){return!!h.rtpReceiver}).map(function(h){return h.rtpReceiver})},k.prototype._createIceGatherer=function(h,m){var b=this;if(m&&h>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var s=new g.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(s,"state",{value:"new",writable:!0}),this.transceivers[h].bufferedCandidateEvents=[],this.transceivers[h].bufferCandidates=function(E){var B=!E.candidate||0===Object.keys(E.candidate).length;s.state=B?"completed":"gathering",null!==b.transceivers[h].bufferedCandidateEvents&&b.transceivers[h].bufferedCandidateEvents.push(E)},s.addEventListener("localcandidate",this.transceivers[h].bufferCandidates),s},k.prototype._gather=function(h,m){var b=this,s=this.transceivers[m].iceGatherer;if(!s.onlocalcandidate){var E=this.transceivers[m].bufferedCandidateEvents;this.transceivers[m].bufferedCandidateEvents=null,s.removeEventListener("localcandidate",this.transceivers[m].bufferCandidates),s.onlocalcandidate=function(B){if(!(b.usingBundle&&m>0)){var R=new Event("icecandidate");R.candidate={sdpMid:h,sdpMLineIndex:m};var N=B.candidate,W=!N||0===Object.keys(N).length;if(W)("new"===s.state||"gathering"===s.state)&&(s.state="completed");else{"new"===s.state&&(s.state="gathering"),N.component=1,N.ufrag=s.getLocalParameters().usernameFragment;var O=p.writeCandidate(N);R.candidate=Object.assign(R.candidate,p.parseCandidate(O)),R.candidate.candidate=O,R.candidate.toJSON=function(){return{candidate:R.candidate.candidate,sdpMid:R.candidate.sdpMid,sdpMLineIndex:R.candidate.sdpMLineIndex,usernameFragment:R.candidate.usernameFragment}}}var I=p.getMediaSections(b._localDescription.sdp);I[R.candidate.sdpMLineIndex]+=W?"a=end-of-candidates\r\n":"a="+R.candidate.candidate+"\r\n",b._localDescription.sdp=p.getDescription(b._localDescription.sdp)+I.join("");var ne=b.transceivers.every(function(Y){return Y.iceGatherer&&"completed"===Y.iceGatherer.state});"gathering"!==b.iceGatheringState&&(b.iceGatheringState="gathering",b._emitGatheringStateChange()),W||b._dispatchEvent("icecandidate",R),ne&&(b._dispatchEvent("icecandidate",new Event("icecandidate")),b.iceGatheringState="complete",b._emitGatheringStateChange())}},g.setTimeout(function(){E.forEach(function(B){s.onlocalcandidate(B)})},0)}},k.prototype._createIceAndDtlsTransports=function(){var h=this,m=new g.RTCIceTransport(null);m.onicestatechange=function(){h._updateIceConnectionState(),h._updateConnectionState()};var b=new g.RTCDtlsTransport(m);return b.ondtlsstatechange=function(){h._updateConnectionState()},b.onerror=function(){Object.defineProperty(b,"state",{value:"failed",writable:!0}),h._updateConnectionState()},{iceTransport:m,dtlsTransport:b}},k.prototype._disposeIceAndDtlsTransports=function(h){var m=this.transceivers[h].iceGatherer;m&&(delete m.onlocalcandidate,delete this.transceivers[h].iceGatherer);var b=this.transceivers[h].iceTransport;b&&(delete b.onicestatechange,delete this.transceivers[h].iceTransport);var s=this.transceivers[h].dtlsTransport;s&&(delete s.ondtlsstatechange,delete s.onerror,delete this.transceivers[h].dtlsTransport)},k.prototype._transceive=function(h,m,b){var s=F(h.localCapabilities,h.remoteCapabilities);m&&h.rtpSender&&(s.encodings=h.sendEncodingParameters,s.rtcp={cname:p.localCName,compound:h.rtcpParameters.compound},h.recvEncodingParameters.length&&(s.rtcp.ssrc=h.recvEncodingParameters[0].ssrc),h.rtpSender.send(s)),b&&h.rtpReceiver&&s.codecs.length>0&&("video"===h.kind&&h.recvEncodingParameters&&v<15019&&h.recvEncodingParameters.forEach(function(E){delete E.rtx}),s.encodings=h.recvEncodingParameters.length?h.recvEncodingParameters:[{}],s.rtcp={compound:h.rtcpParameters.compound},h.rtcpParameters.cname&&(s.rtcp.cname=h.rtcpParameters.cname),h.sendEncodingParameters.length&&(s.rtcp.ssrc=h.sendEncodingParameters[0].ssrc),h.rtpReceiver.receive(s))},k.prototype.setLocalDescription=function(h){var b,s,m=this;if(-1===["offer","answer"].indexOf(h.type))return Promise.reject(f("TypeError",'Unsupported type "'+h.type+'"'));if(!q("setLocalDescription",h.type,m.signalingState)||m._isClosed)return Promise.reject(f("InvalidStateError","Can not set local "+h.type+" in state "+m.signalingState));if("offer"===h.type)b=p.splitSections(h.sdp),s=b.shift(),b.forEach(function(B,R){var N=p.parseRtpParameters(B);m.transceivers[R].localCapabilities=N}),m.transceivers.forEach(function(B,R){m._gather(B.mid,R)});else if("answer"===h.type){b=p.splitSections(m._remoteDescription.sdp),s=b.shift();var E=p.matchPrefix(s,"a=ice-lite").length>0;b.forEach(function(B,R){var N=m.transceivers[R],W=N.iceGatherer,O=N.iceTransport,I=N.dtlsTransport,ne=N.localCapabilities,Y=N.remoteCapabilities;if(!(p.isRejected(B)&&0===p.matchPrefix(B,"a=bundle-only").length||N.rejected)){var Q=p.getIceParameters(B,s),ie=p.getDtlsParameters(B,s);E&&(ie.role="server"),(!m.usingBundle||0===R)&&(m._gather(N.mid,R),"new"===O.state&&O.start(W,Q,E?"controlling":"controlled"),"new"===I.state&&I.start(ie));var K=F(ne,Y);m._transceive(N,K.codecs.length>0,!1)}})}return m._localDescription={type:h.type,sdp:h.sdp},m._updateSignalingState("offer"===h.type?"have-local-offer":"stable"),Promise.resolve()},k.prototype.setRemoteDescription=function(h){var m=this;if(-1===["offer","answer"].indexOf(h.type))return Promise.reject(f("TypeError",'Unsupported type "'+h.type+'"'));if(!q("setRemoteDescription",h.type,m.signalingState)||m._isClosed)return Promise.reject(f("InvalidStateError","Can not set remote "+h.type+" in state "+m.signalingState));var b={};m.remoteStreams.forEach(function(O){b[O.id]=O});var s=[],E=p.splitSections(h.sdp),B=E.shift(),R=p.matchPrefix(B,"a=ice-lite").length>0,N=p.matchPrefix(B,"a=group:BUNDLE ").length>0;m.usingBundle=N;var W=p.matchPrefix(B,"a=ice-options:")[0];return m.canTrickleIceCandidates=!!W&&W.substr(14).split(" ").indexOf("trickle")>=0,E.forEach(function(O,I){var ne=p.splitLines(O),Y=p.getKind(O),$=p.isRejected(O)&&0===p.matchPrefix(O,"a=bundle-only").length,Q=ne[0].substr(2).split(" ")[2],ie=p.getDirection(O,B),K=p.parseMsid(O),Ne=p.getMid(O)||p.generateIdentifier();if($||"application"===Y&&("DTLS/SCTP"===Q||"UDP/DTLS/SCTP"===Q))m.transceivers[I]={mid:Ne,kind:Y,protocol:Q,rejected:!0};else{!$&&m.transceivers[I]&&m.transceivers[I].rejected&&(m.transceivers[I]=m._createTransceiver(Y,!0));var G,Le,Se,Ie,me,we,Be,Te,pe,ze,Fe,Ue=p.parseRtpParameters(O);$||(ze=p.getIceParameters(O,B),(Fe=p.getDtlsParameters(O,B)).role="client"),Be=p.parseRtpEncodingParameters(O);var je=p.parseRtcpParameters(O),He=p.matchPrefix(O,"a=end-of-candidates",B).length>0,ke=p.matchPrefix(O,"a=candidate:").map(function(ee){return p.parseCandidate(ee)}).filter(function(ee){return 1===ee.component});if(("offer"===h.type||"answer"===h.type)&&!$&&N&&I>0&&m.transceivers[I]&&(m._disposeIceAndDtlsTransports(I),m.transceivers[I].iceGatherer=m.transceivers[0].iceGatherer,m.transceivers[I].iceTransport=m.transceivers[0].iceTransport,m.transceivers[I].dtlsTransport=m.transceivers[0].dtlsTransport,m.transceivers[I].rtpSender&&m.transceivers[I].rtpSender.setTransport(m.transceivers[0].dtlsTransport),m.transceivers[I].rtpReceiver&&m.transceivers[I].rtpReceiver.setTransport(m.transceivers[0].dtlsTransport)),"offer"!==h.type||$)"answer"!==h.type||$||(Le=(G=m.transceivers[I]).iceGatherer,Se=G.iceTransport,Ie=G.dtlsTransport,me=G.rtpReceiver,we=G.sendEncodingParameters,Te=G.localCapabilities,m.transceivers[I].recvEncodingParameters=Be,m.transceivers[I].remoteCapabilities=Ue,m.transceivers[I].rtcpParameters=je,ke.length&&"new"===Se.state&&(!R&&!He||N&&0!==I?ke.forEach(function(ee){X(G.iceTransport,ee)}):Se.setRemoteCandidates(ke)),(!N||0===I)&&("new"===Se.state&&Se.start(Le,ze,"controlling"),"new"===Ie.state&&Ie.start(Fe)),!F(G.localCapabilities,G.remoteCapabilities).codecs.filter(function(ee){return"rtx"===ee.name.toLowerCase()}).length&&G.sendEncodingParameters[0].rtx&&delete G.sendEncodingParameters[0].rtx,m._transceive(G,"sendrecv"===ie||"recvonly"===ie,"sendrecv"===ie||"sendonly"===ie),!me||"sendrecv"!==ie&&"sendonly"!==ie?delete G.rtpReceiver:(pe=me.track,K?(b[K.stream]||(b[K.stream]=new g.MediaStream),w(pe,b[K.stream]),s.push([pe,me,b[K.stream]])):(b.default||(b.default=new g.MediaStream),w(pe,b.default),s.push([pe,me,b.default]))));else{(G=m.transceivers[I]||m._createTransceiver(Y)).mid=Ne,G.iceGatherer||(G.iceGatherer=m._createIceGatherer(I,N)),ke.length&&"new"===G.iceTransport.state&&(!He||N&&0!==I?ke.forEach(function(ee){X(G.iceTransport,ee)}):G.iceTransport.setRemoteCandidates(ke)),Te=g.RTCRtpReceiver.getCapabilities(Y),v<15019&&(Te.codecs=Te.codecs.filter(function(ee){return"rtx"!==ee.name})),we=G.sendEncodingParameters||[{ssrc:1001*(2*I+2)}];var Ee,$e=!1;"sendrecv"===ie||"sendonly"===ie?($e=!G.rtpReceiver,me=G.rtpReceiver||new g.RTCRtpReceiver(G.dtlsTransport,Y),$e&&(pe=me.track,K&&"-"===K.stream||(K?(b[K.stream]||(b[K.stream]=new g.MediaStream,Object.defineProperty(b[K.stream],"id",{get:function(){return K.stream}})),Object.defineProperty(pe,"id",{get:function(){return K.track}}),Ee=b[K.stream]):(b.default||(b.default=new g.MediaStream),Ee=b.default)),Ee&&(w(pe,Ee),G.associatedRemoteMediaStreams.push(Ee)),s.push([pe,me,Ee]))):G.rtpReceiver&&G.rtpReceiver.track&&(G.associatedRemoteMediaStreams.forEach(function(ee){var We=ee.getTracks().find(function(st){return st.id===G.rtpReceiver.track.id});We&&function j(h,m){m.removeTrack(h),m.dispatchEvent(new g.MediaStreamTrackEvent("removetrack",{track:h}))}(We,ee)}),G.associatedRemoteMediaStreams=[]),G.localCapabilities=Te,G.remoteCapabilities=Ue,G.rtpReceiver=me,G.rtcpParameters=je,G.sendEncodingParameters=we,G.recvEncodingParameters=Be,m._transceive(m.transceivers[I],!1,$e)}}}),void 0===m._dtlsRole&&(m._dtlsRole="offer"===h.type?"active":"passive"),m._remoteDescription={type:h.type,sdp:h.sdp},m._updateSignalingState("offer"===h.type?"have-remote-offer":"stable"),Object.keys(b).forEach(function(O){var I=b[O];if(I.getTracks().length){if(-1===m.remoteStreams.indexOf(I)){m.remoteStreams.push(I);var ne=new Event("addstream");ne.stream=I,g.setTimeout(function(){m._dispatchEvent("addstream",ne)})}s.forEach(function(Y){I.id===Y[2].id&&H(m,Y[0],Y[1],[I])})}}),s.forEach(function(O){O[2]||H(m,O[0],O[1],[])}),g.setTimeout(function(){!m||!m.transceivers||m.transceivers.forEach(function(O){O.iceTransport&&"new"===O.iceTransport.state&&O.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),O.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},k.prototype.close=function(){this.transceivers.forEach(function(h){h.iceTransport&&h.iceTransport.stop(),h.dtlsTransport&&h.dtlsTransport.stop(),h.rtpSender&&h.rtpSender.stop(),h.rtpReceiver&&h.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},k.prototype._updateSignalingState=function(h){this.signalingState=h;var m=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",m)},k.prototype._maybeFireNegotiationNeeded=function(){var h=this;"stable"!==this.signalingState||!0===this.needNegotiation||(this.needNegotiation=!0,g.setTimeout(function(){if(h.needNegotiation){h.needNegotiation=!1;var m=new Event("negotiationneeded");h._dispatchEvent("negotiationneeded",m)}},0))},k.prototype._updateIceConnectionState=function(){var h,m={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(s){s.iceTransport&&!s.rejected&&m[s.iceTransport.state]++}),h="new",m.failed>0?h="failed":m.checking>0?h="checking":m.disconnected>0?h="disconnected":m.new>0?h="new":m.connected>0?h="connected":m.completed>0&&(h="completed"),h!==this.iceConnectionState){this.iceConnectionState=h;var b=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",b)}},k.prototype._updateConnectionState=function(){var h,m={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(s){s.iceTransport&&s.dtlsTransport&&!s.rejected&&(m[s.iceTransport.state]++,m[s.dtlsTransport.state]++)}),m.connected+=m.completed,h="new",m.failed>0?h="failed":m.connecting>0?h="connecting":m.disconnected>0?h="disconnected":m.new>0?h="new":m.connected>0&&(h="connected"),h!==this.connectionState){this.connectionState=h;var b=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",b)}},k.prototype.createOffer=function(){var h=this;if(h._isClosed)return Promise.reject(f("InvalidStateError","Can not call createOffer after close"));var m=h.transceivers.filter(function(R){return"audio"===R.kind}).length,b=h.transceivers.filter(function(R){return"video"===R.kind}).length,s=arguments[0];if(s){if(s.mandatory||s.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==s.offerToReceiveAudio&&(m=!0===s.offerToReceiveAudio?1:!1===s.offerToReceiveAudio?0:s.offerToReceiveAudio),void 0!==s.offerToReceiveVideo&&(b=!0===s.offerToReceiveVideo?1:!1===s.offerToReceiveVideo?0:s.offerToReceiveVideo)}for(h.transceivers.forEach(function(R){"audio"===R.kind?--m<0&&(R.wantReceive=!1):"video"===R.kind&&--b<0&&(R.wantReceive=!1)});m>0||b>0;)m>0&&(h._createTransceiver("audio"),m--),b>0&&(h._createTransceiver("video"),b--);var E=p.writeSessionBoilerplate(h._sdpSessionId,h._sdpSessionVersion++);h.transceivers.forEach(function(R,N){var W=R.track,O=R.kind,I=R.mid||p.generateIdentifier();R.mid=I,R.iceGatherer||(R.iceGatherer=h._createIceGatherer(N,h.usingBundle));var ne=g.RTCRtpSender.getCapabilities(O);v<15019&&(ne.codecs=ne.codecs.filter(function($){return"rtx"!==$.name})),ne.codecs.forEach(function($){"H264"===$.name&&void 0===$.parameters["level-asymmetry-allowed"]&&($.parameters["level-asymmetry-allowed"]="1"),R.remoteCapabilities&&R.remoteCapabilities.codecs&&R.remoteCapabilities.codecs.forEach(function(Q){$.name.toLowerCase()===Q.name.toLowerCase()&&$.clockRate===Q.clockRate&&($.preferredPayloadType=Q.payloadType)})}),ne.headerExtensions.forEach(function($){(R.remoteCapabilities&&R.remoteCapabilities.headerExtensions||[]).forEach(function(ie){$.uri===ie.uri&&($.id=ie.id)})});var Y=R.sendEncodingParameters||[{ssrc:1001*(2*N+1)}];W&&v>=15019&&"video"===O&&!Y[0].rtx&&(Y[0].rtx={ssrc:Y[0].ssrc+1}),R.wantReceive&&(R.rtpReceiver=new g.RTCRtpReceiver(R.dtlsTransport,O)),R.localCapabilities=ne,R.sendEncodingParameters=Y}),"max-compat"!==h._config.bundlePolicy&&(E+="a=group:BUNDLE "+h.transceivers.map(function(R){return R.mid}).join(" ")+"\r\n"),E+="a=ice-options:trickle\r\n",h.transceivers.forEach(function(R,N){E+=x(R,R.localCapabilities,"offer",R.stream,h._dtlsRole),E+="a=rtcp-rsize\r\n",R.iceGatherer&&"new"!==h.iceGatheringState&&(0===N||!h.usingBundle)&&(R.iceGatherer.getLocalCandidates().forEach(function(W){W.component=1,E+="a="+p.writeCandidate(W)+"\r\n"}),"completed"===R.iceGatherer.state&&(E+="a=end-of-candidates\r\n"))});var B=new g.RTCSessionDescription({type:"offer",sdp:E});return Promise.resolve(B)},k.prototype.createAnswer=function(){var h=this;if(h._isClosed)return Promise.reject(f("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==h.signalingState&&"have-local-pranswer"!==h.signalingState)return Promise.reject(f("InvalidStateError","Can not call createAnswer in signalingState "+h.signalingState));var m=p.writeSessionBoilerplate(h._sdpSessionId,h._sdpSessionVersion++);h.usingBundle&&(m+="a=group:BUNDLE "+h.transceivers.map(function(E){return E.mid}).join(" ")+"\r\n"),m+="a=ice-options:trickle\r\n";var b=p.getMediaSections(h._remoteDescription.sdp).length;h.transceivers.forEach(function(E,B){if(!(B+1>b)){if(E.rejected)return"application"===E.kind?m+="DTLS/SCTP"===E.protocol?"m=application 0 DTLS/SCTP 5000\r\n":"m=application 0 "+E.protocol+" webrtc-datachannel\r\n":"audio"===E.kind?m+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===E.kind&&(m+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(m+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+E.mid+"\r\n");var R;E.stream&&("audio"===E.kind?R=E.stream.getAudioTracks()[0]:"video"===E.kind&&(R=E.stream.getVideoTracks()[0]),R&&v>=15019&&"video"===E.kind&&!E.sendEncodingParameters[0].rtx&&(E.sendEncodingParameters[0].rtx={ssrc:E.sendEncodingParameters[0].ssrc+1}));var N=F(E.localCapabilities,E.remoteCapabilities);!N.codecs.filter(function(O){return"rtx"===O.name.toLowerCase()}).length&&E.sendEncodingParameters[0].rtx&&delete E.sendEncodingParameters[0].rtx,m+=x(E,N,"answer",E.stream,h._dtlsRole),E.rtcpParameters&&E.rtcpParameters.reducedSize&&(m+="a=rtcp-rsize\r\n")}});var s=new g.RTCSessionDescription({type:"answer",sdp:m});return Promise.resolve(s)},k.prototype.addIceCandidate=function(h){var b,m=this;return h&&void 0===h.sdpMLineIndex&&!h.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(s,E){if(!m._remoteDescription)return E(f("InvalidStateError","Can not add ICE candidate without a remote description"));if(h&&""!==h.candidate){var R=h.sdpMLineIndex;if(h.sdpMid)for(var N=0;N<m.transceivers.length;N++)if(m.transceivers[N].mid===h.sdpMid){R=N;break}var W=m.transceivers[R];if(!W)return E(f("OperationError","Can not add ICE candidate"));if(W.rejected)return s();var O=Object.keys(h.candidate).length>0?p.parseCandidate(h.candidate):{};if("tcp"===O.protocol&&(0===O.port||9===O.port)||O.component&&1!==O.component)return s();if((0===R||R>0&&W.iceTransport!==m.transceivers[0].iceTransport)&&!X(W.iceTransport,O))return E(f("OperationError","Can not add ICE candidate"));var I=h.candidate.trim();0===I.indexOf("a=")&&(I=I.substr(2)),(b=p.getMediaSections(m._remoteDescription.sdp))[R]+="a="+(O.type?I:"end-of-candidates")+"\r\n",m._remoteDescription.sdp=p.getDescription(m._remoteDescription.sdp)+b.join("")}else for(var B=0;B<m.transceivers.length&&(m.transceivers[B].rejected||(m.transceivers[B].iceTransport.addRemoteCandidate({}),(b=p.getMediaSections(m._remoteDescription.sdp))[B]+="a=end-of-candidates\r\n",m._remoteDescription.sdp=p.getDescription(m._remoteDescription.sdp)+b.join(""),!m.usingBundle));B++);s()})},k.prototype.getStats=function(h){if(h&&h instanceof g.MediaStreamTrack){var m=null;if(this.transceivers.forEach(function(s){s.rtpSender&&s.rtpSender.track===h?m=s.rtpSender:s.rtpReceiver&&s.rtpReceiver.track===h&&(m=s.rtpReceiver)}),!m)throw f("InvalidAccessError","Invalid selector.");return m.getStats()}var b=[];return this.transceivers.forEach(function(s){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(E){s[E]&&b.push(s[E].getStats())})}),Promise.all(b).then(function(s){var E=new Map;return s.forEach(function(B){B.forEach(function(R){E.set(R.id,R)})}),E})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(h){var m=g[h];if(m&&m.prototype&&m.prototype.getStats){var b=m.prototype.getStats;m.prototype.getStats=function(){return b.apply(this).then(function(s){var E=new Map;return Object.keys(s).forEach(function(B){s[B].type=function C(g){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[g.type]||g.type}(s[B]),E.set(B,s[B])}),E})}}});var L=["createOffer","createAnswer"];return L.forEach(function(h){var m=k.prototype[h];k.prototype[h]=function(){var b=arguments;return"function"==typeof b[0]||"function"==typeof b[1]?m.apply(this,[arguments[2]]).then(function(s){"function"==typeof b[0]&&b[0].apply(null,[s])},function(s){"function"==typeof b[1]&&b[1].apply(null,[s])}):m.apply(this,arguments)}}),(L=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(h){var m=k.prototype[h];k.prototype[h]=function(){var b=arguments;return"function"==typeof b[1]||"function"==typeof b[2]?m.apply(this,arguments).then(function(){"function"==typeof b[1]&&b[1].apply(null)},function(s){"function"==typeof b[2]&&b[2].apply(null,[s])}):m.apply(this,arguments)}}),["getStats"].forEach(function(h){var m=k.prototype[h];k.prototype[h]=function(){var b=arguments;return"function"==typeof b[1]?m.apply(this,arguments).then(function(){"function"==typeof b[1]&&b[1].apply(null)}):m.apply(this,arguments)}}),k}},7463:fe=>{"use strict";var S={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};S.localCName=S.generateIdentifier(),S.splitLines=function(d){return d.trim().split("\n").map(function(p){return p.trim()})},S.splitSections=function(d){return d.split("\nm=").map(function(C,x){return(x>0?"m="+C:C).trim()+"\r\n"})},S.getDescription=function(d){var p=S.splitSections(d);return p&&p[0]},S.getMediaSections=function(d){var p=S.splitSections(d);return p.shift(),p},S.matchPrefix=function(d,p){return S.splitLines(d).filter(function(C){return 0===C.indexOf(p)})},S.parseCandidate=function(d){for(var p,C={foundation:(p=0===d.indexOf("a=candidate:")?d.substring(12).split(" "):d.substring(10).split(" "))[0],component:parseInt(p[1],10),protocol:p[2].toLowerCase(),priority:parseInt(p[3],10),ip:p[4],address:p[4],port:parseInt(p[5],10),type:p[7]},x=8;x<p.length;x+=2)switch(p[x]){case"raddr":C.relatedAddress=p[x+1];break;case"rport":C.relatedPort=parseInt(p[x+1],10);break;case"tcptype":C.tcpType=p[x+1];break;case"ufrag":C.ufrag=p[x+1],C.usernameFragment=p[x+1];break;default:C[p[x]]=p[x+1]}return C},S.writeCandidate=function(d){var p=[];p.push(d.foundation),p.push(d.component),p.push(d.protocol.toUpperCase()),p.push(d.priority),p.push(d.address||d.ip),p.push(d.port);var C=d.type;return p.push("typ"),p.push(C),"host"!==C&&d.relatedAddress&&d.relatedPort&&(p.push("raddr"),p.push(d.relatedAddress),p.push("rport"),p.push(d.relatedPort)),d.tcpType&&"tcp"===d.protocol.toLowerCase()&&(p.push("tcptype"),p.push(d.tcpType)),(d.usernameFragment||d.ufrag)&&(p.push("ufrag"),p.push(d.usernameFragment||d.ufrag)),"candidate:"+p.join(" ")},S.parseIceOptions=function(d){return d.substr(14).split(" ")},S.parseRtpMap=function(d){var p=d.substr(9).split(" "),C={payloadType:parseInt(p.shift(),10)};return p=p[0].split("/"),C.name=p[0],C.clockRate=parseInt(p[1],10),C.channels=3===p.length?parseInt(p[2],10):1,C.numChannels=C.channels,C},S.writeRtpMap=function(d){var p=d.payloadType;void 0!==d.preferredPayloadType&&(p=d.preferredPayloadType);var C=d.channels||d.numChannels||1;return"a=rtpmap:"+p+" "+d.name+"/"+d.clockRate+(1!==C?"/"+C:"")+"\r\n"},S.parseExtmap=function(d){var p=d.substr(9).split(" ");return{id:parseInt(p[0],10),direction:p[0].indexOf("/")>0?p[0].split("/")[1]:"sendrecv",uri:p[1]}},S.writeExtmap=function(d){return"a=extmap:"+(d.id||d.preferredId)+(d.direction&&"sendrecv"!==d.direction?"/"+d.direction:"")+" "+d.uri+"\r\n"},S.parseFmtp=function(d){for(var C,p={},x=d.substr(d.indexOf(" ")+1).split(";"),P=0;P<x.length;P++)p[(C=x[P].trim().split("="))[0].trim()]=C[1];return p},S.writeFmtp=function(d){var p="",C=d.payloadType;if(void 0!==d.preferredPayloadType&&(C=d.preferredPayloadType),d.parameters&&Object.keys(d.parameters).length){var x=[];Object.keys(d.parameters).forEach(function(P){x.push(d.parameters[P]?P+"="+d.parameters[P]:P)}),p+="a=fmtp:"+C+" "+x.join(";")+"\r\n"}return p},S.parseRtcpFb=function(d){var p=d.substr(d.indexOf(" ")+1).split(" ");return{type:p.shift(),parameter:p.join(" ")}},S.writeRtcpFb=function(d){var p="",C=d.payloadType;return void 0!==d.preferredPayloadType&&(C=d.preferredPayloadType),d.rtcpFeedback&&d.rtcpFeedback.length&&d.rtcpFeedback.forEach(function(x){p+="a=rtcp-fb:"+C+" "+x.type+(x.parameter&&x.parameter.length?" "+x.parameter:"")+"\r\n"}),p},S.parseSsrcMedia=function(d){var p=d.indexOf(" "),C={ssrc:parseInt(d.substr(7,p-7),10)},x=d.indexOf(":",p);return x>-1?(C.attribute=d.substr(p+1,x-p-1),C.value=d.substr(x+1)):C.attribute=d.substr(p+1),C},S.parseSsrcGroup=function(d){var p=d.substr(13).split(" ");return{semantics:p.shift(),ssrcs:p.map(function(C){return parseInt(C,10)})}},S.getMid=function(d){var p=S.matchPrefix(d,"a=mid:")[0];if(p)return p.substr(6)},S.parseFingerprint=function(d){var p=d.substr(14).split(" ");return{algorithm:p[0].toLowerCase(),value:p[1]}},S.getDtlsParameters=function(d,p){return{role:"auto",fingerprints:S.matchPrefix(d+p,"a=fingerprint:").map(S.parseFingerprint)}},S.writeDtlsParameters=function(d,p){var C="a=setup:"+p+"\r\n";return d.fingerprints.forEach(function(x){C+="a=fingerprint:"+x.algorithm+" "+x.value+"\r\n"}),C},S.parseCryptoLine=function(d){var p=d.substr(9).split(" ");return{tag:parseInt(p[0],10),cryptoSuite:p[1],keyParams:p[2],sessionParams:p.slice(3)}},S.writeCryptoLine=function(d){return"a=crypto:"+d.tag+" "+d.cryptoSuite+" "+("object"==typeof d.keyParams?S.writeCryptoKeyParams(d.keyParams):d.keyParams)+(d.sessionParams?" "+d.sessionParams.join(" "):"")+"\r\n"},S.parseCryptoKeyParams=function(d){if(0!==d.indexOf("inline:"))return null;var p=d.substr(7).split("|");return{keyMethod:"inline",keySalt:p[0],lifeTime:p[1],mkiValue:p[2]?p[2].split(":")[0]:void 0,mkiLength:p[2]?p[2].split(":")[1]:void 0}},S.writeCryptoKeyParams=function(d){return d.keyMethod+":"+d.keySalt+(d.lifeTime?"|"+d.lifeTime:"")+(d.mkiValue&&d.mkiLength?"|"+d.mkiValue+":"+d.mkiLength:"")},S.getCryptoParameters=function(d,p){return S.matchPrefix(d+p,"a=crypto:").map(S.parseCryptoLine)},S.getIceParameters=function(d,p){var C=S.matchPrefix(d+p,"a=ice-ufrag:")[0],x=S.matchPrefix(d+p,"a=ice-pwd:")[0];return C&&x?{usernameFragment:C.substr(12),password:x.substr(10)}:null},S.writeIceParameters=function(d){return"a=ice-ufrag:"+d.usernameFragment+"\r\na=ice-pwd:"+d.password+"\r\n"},S.parseRtpParameters=function(d){for(var p={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},x=S.splitLines(d)[0].split(" "),P=3;P<x.length;P++){var F=x[P],q=S.matchPrefix(d,"a=rtpmap:"+F+" ")[0];if(q){var X=S.parseRtpMap(q),f=S.matchPrefix(d,"a=fmtp:"+F+" ");switch(X.parameters=f.length?S.parseFmtp(f[0]):{},X.rtcpFeedback=S.matchPrefix(d,"a=rtcp-fb:"+F+" ").map(S.parseRtcpFb),p.codecs.push(X),X.name.toUpperCase()){case"RED":case"ULPFEC":p.fecMechanisms.push(X.name.toUpperCase())}}}return S.matchPrefix(d,"a=extmap:").forEach(function(g){p.headerExtensions.push(S.parseExtmap(g))}),p},S.writeRtpDescription=function(d,p){var C="";C+="m="+d+" ",C+=p.codecs.length>0?"9":"0",C+=" UDP/TLS/RTP/SAVPF ",C+=p.codecs.map(function(P){return void 0!==P.preferredPayloadType?P.preferredPayloadType:P.payloadType}).join(" ")+"\r\n",C+="c=IN IP4 0.0.0.0\r\n",C+="a=rtcp:9 IN IP4 0.0.0.0\r\n",p.codecs.forEach(function(P){C+=S.writeRtpMap(P),C+=S.writeFmtp(P),C+=S.writeRtcpFb(P)});var x=0;return p.codecs.forEach(function(P){P.maxptime>x&&(x=P.maxptime)}),x>0&&(C+="a=maxptime:"+x+"\r\n"),C+="a=rtcp-mux\r\n",p.headerExtensions&&p.headerExtensions.forEach(function(P){C+=S.writeExtmap(P)}),C},S.parseRtpEncodingParameters=function(d){var X,p=[],C=S.parseRtpParameters(d),x=-1!==C.fecMechanisms.indexOf("RED"),P=-1!==C.fecMechanisms.indexOf("ULPFEC"),F=S.matchPrefix(d,"a=ssrc:").map(function(v){return S.parseSsrcMedia(v)}).filter(function(v){return"cname"===v.attribute}),q=F.length>0&&F[0].ssrc,f=S.matchPrefix(d,"a=ssrc-group:FID").map(function(v){return v.substr(17).split(" ").map(function(j){return parseInt(j,10)})});f.length>0&&f[0].length>1&&f[0][0]===q&&(X=f[0][1]),C.codecs.forEach(function(v){if("RTX"===v.name.toUpperCase()&&v.parameters.apt){var w={ssrc:q,codecPayloadType:parseInt(v.parameters.apt,10)};q&&X&&(w.rtx={ssrc:X}),p.push(w),x&&((w=JSON.parse(JSON.stringify(w))).fec={ssrc:q,mechanism:P?"red+ulpfec":"red"},p.push(w))}}),0===p.length&&q&&p.push({ssrc:q});var g=S.matchPrefix(d,"b=");return g.length&&(g=0===g[0].indexOf("b=TIAS:")?parseInt(g[0].substr(7),10):0===g[0].indexOf("b=AS:")?1e3*parseInt(g[0].substr(5),10)*.95-16e3:void 0,p.forEach(function(v){v.maxBitrate=g})),p},S.parseRtcpParameters=function(d){var p={},C=S.matchPrefix(d,"a=ssrc:").map(function(F){return S.parseSsrcMedia(F)}).filter(function(F){return"cname"===F.attribute})[0];C&&(p.cname=C.value,p.ssrc=C.ssrc);var x=S.matchPrefix(d,"a=rtcp-rsize");p.reducedSize=x.length>0,p.compound=0===x.length;var P=S.matchPrefix(d,"a=rtcp-mux");return p.mux=P.length>0,p},S.parseMsid=function(d){var p,C=S.matchPrefix(d,"a=msid:");if(1===C.length)return{stream:(p=C[0].substr(7).split(" "))[0],track:p[1]};var x=S.matchPrefix(d,"a=ssrc:").map(function(P){return S.parseSsrcMedia(P)}).filter(function(P){return"msid"===P.attribute});return x.length>0?{stream:(p=x[0].value.split(" "))[0],track:p[1]}:void 0},S.parseSctpDescription=function(d){var x,p=S.parseMLine(d),C=S.matchPrefix(d,"a=max-message-size:");C.length>0&&(x=parseInt(C[0].substr(19),10)),isNaN(x)&&(x=65536);var P=S.matchPrefix(d,"a=sctp-port:");if(P.length>0)return{port:parseInt(P[0].substr(12),10),protocol:p.fmt,maxMessageSize:x};if(S.matchPrefix(d,"a=sctpmap:").length>0){var q=S.matchPrefix(d,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(q[0],10),protocol:q[1],maxMessageSize:x}}},S.writeSctpDescription=function(d,p){var C=[];return C="DTLS/SCTP"!==d.protocol?["m="+d.kind+" 9 "+d.protocol+" "+p.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+p.port+"\r\n"]:["m="+d.kind+" 9 "+d.protocol+" "+p.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+p.port+" "+p.protocol+" 65535\r\n"],void 0!==p.maxMessageSize&&C.push("a=max-message-size:"+p.maxMessageSize+"\r\n"),C.join("")},S.generateSessionId=function(){return Math.random().toString().substr(2,21)},S.writeSessionBoilerplate=function(d,p,C){var P=void 0!==p?p:2;return"v=0\r\no="+(C||"thisisadapterortc")+" "+(d||S.generateSessionId())+" "+P+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},S.writeMediaSection=function(d,p,C,x){var P=S.writeRtpDescription(d.kind,p);if(P+=S.writeIceParameters(d.iceGatherer.getLocalParameters()),P+=S.writeDtlsParameters(d.dtlsTransport.getLocalParameters(),"offer"===C?"actpass":"active"),P+="a=mid:"+d.mid+"\r\n",P+=d.direction?"a="+d.direction+"\r\n":d.rtpSender&&d.rtpReceiver?"a=sendrecv\r\n":d.rtpSender?"a=sendonly\r\n":d.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",d.rtpSender){var F="msid:"+x.id+" "+d.rtpSender.track.id+"\r\n";P+="a="+F,P+="a=ssrc:"+d.sendEncodingParameters[0].ssrc+" "+F,d.sendEncodingParameters[0].rtx&&(P+="a=ssrc:"+d.sendEncodingParameters[0].rtx.ssrc+" "+F,P+="a=ssrc-group:FID "+d.sendEncodingParameters[0].ssrc+" "+d.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return P+="a=ssrc:"+d.sendEncodingParameters[0].ssrc+" cname:"+S.localCName+"\r\n",d.rtpSender&&d.sendEncodingParameters[0].rtx&&(P+="a=ssrc:"+d.sendEncodingParameters[0].rtx.ssrc+" cname:"+S.localCName+"\r\n"),P},S.getDirection=function(d,p){for(var C=S.splitLines(d),x=0;x<C.length;x++)switch(C[x]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return C[x].substr(2)}return p?S.getDirection(p):"sendrecv"},S.getKind=function(d){return S.splitLines(d)[0].split(" ")[0].substr(2)},S.isRejected=function(d){return"0"===d.split(" ",2)[1]},S.parseMLine=function(d){var C=S.splitLines(d)[0].substr(2).split(" ");return{kind:C[0],port:parseInt(C[1],10),protocol:C[2],fmt:C.slice(3).join(" ")}},S.parseOLine=function(d){var C=S.matchPrefix(d,"o=")[0].substr(2).split(" ");return{username:C[0],sessionId:C[1],sessionVersion:parseInt(C[2],10),netType:C[3],addressType:C[4],address:C[5]}},S.isValidSDP=function(d){if("string"!=typeof d||0===d.length)return!1;for(var p=S.splitLines(d),C=0;C<p.length;C++)if(p[C].length<2||"="!==p[C].charAt(1))return!1;return!0},fe.exports=S}}]);
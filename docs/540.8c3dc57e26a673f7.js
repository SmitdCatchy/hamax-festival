"use strict";(self.webpackChunksmitd_game_poc=self.webpackChunksmitd_game_poc||[]).push([[540],{4540:(W,b,g)=>{g.r(b),g.d(b,{MenuModule:()=>G});var A=g(9808),I=g(1589),B=g(4237),D=g.n(B),f=g(967),i=g(6682),n=g(5e3),V=g(9601),C=g(7423),L=g(678);const x=function(){return["/game"]},k=function(){return["/adam-longer"]},T=function(){return["/caspien"]},z=function(){return["/catchy"]};var w=(()=>{return(c=w||(w={}))[c.ACTIVE=1]="ACTIVE",c[c.ISLAND_SLEEPING=2]="ISLAND_SLEEPING",c[c.WANTS_DEACTIVATION=3]="WANTS_DEACTIVATION",c[c.DISABLE_DEACTIVATION=4]="DISABLE_DEACTIVATION",c[c.DISABLE_SIMULATION=5]="DISABLE_SIMULATION",w;var c})();const R=[{path:"",component:(()=>{class c{constructor(t,e,o){this.soundService=t,this.ammoService=e,this.element=o,this.rigidBodies=[],this.cameraDistance=140,this.friction=4,this.rollingFriction=10,this.gravity=-1e3,this.colGroupPlayer=1,this.colGroupPlane=2,this.colGroupBall=4,this.tetrasites=[],this.started=!1}ngAfterViewInit(){this.ammoService.Ammo.subscribe(t=>{this.Ammo=t,this.tmpVec=new this.Ammo.btVector3(0,0,0),this.tmpTrans=new this.Ammo.btTransform,this.init(),this.update()})}start(){this.soundService.initTracks(),this.started=!0}fight(){this.soundService.toggleTrack(f.O.danger)}init(){this.setupPhysicsWorld(),this.setupGraphics(),this.setupWorld(),this.createPlayer(),this.camera.lookAt(this.player.position)}update(){const t=this.clock.getDelta();this.movePlayer(),this.player.position.y<-400&&this.resetPlayer(),this.visionLight.position.set(this.player.position.x+100,this.player.position.y+1e3,this.player.position.z-200),this.updatePhysics(t),requestAnimationFrame(()=>this.update()),this.render()}setupPhysicsWorld(){const t=new this.Ammo.btDefaultCollisionConfiguration,e=new this.Ammo.btCollisionDispatcher(t),o=new this.Ammo.btDbvtBroadphase,s=new this.Ammo.btSequentialImpulseConstraintSolver;this.physicsWorld=new this.Ammo.btDiscreteDynamicsWorld(e,o,s,t),this.tmpVec.setValue(0,this.gravity,0),this.physicsWorld.setGravity(this.tmpVec)}setupGraphics(){this.clock=new i.SUY,this.scene=new i.xsS,this.scene.background=new i.Ilk("#000"),this.setupCamera(),this.setupLights(),this.setupRenderer()}setupCamera(){this.camera=new i.cPb(70,window.innerWidth/window.innerHeight,1,5e3),this.camera.position.set(0,70,this.cameraDistance)}setupLights(){this.visionLight=new i.Ox3(16777215,.6),this.visionLight.position.set(100,1e3,-200),this.visionLight.target.position.set(0,0,0),this.visionLight.castShadow=!0,this.visionLight.shadow.bias=-.01,this.visionLight.shadow.mapSize.width=4096,this.visionLight.shadow.mapSize.height=4096,this.visionLight.shadow.camera.near=.01,this.visionLight.shadow.camera.far=1600,this.visionLight.shadow.camera.fov=70,this.visionLight.shadow.camera.left=1e3,this.visionLight.shadow.camera.right=-1e3,this.visionLight.shadow.camera.top=1e3,this.visionLight.shadow.camera.bottom=-1e3,this.scene.add(this.visionLight),this.scene.add(new i.cBI(this.visionLight,10));const t=new i.Mig(4210752,.8);this.scene.add(t)}setupRenderer(){this.renderer=new i.CP7({antialias:!0}),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=i.ntZ,this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setClearColor("#000"),this.renderer.shadowMap.enabled=!0,this.renderer.domElement.id="TEST",this.element.nativeElement.appendChild(this.renderer.domElement)}setupWorld(){this.createPlane(new i.Pa4(10,10,10),new i.Pa4(0,0,0)),this.createPlane(),this.createPlane(new i.Pa4(4,20,400),new i.Pa4(202,8,0)),this.createPlane(new i.Pa4(4,20,400),new i.Pa4(-202,8,0)),this.createPlane(new i.Pa4(408,60,4),new i.Pa4(0,-30,198)),this.createPlane(new i.Pa4(408,20,4),new i.Pa4(0,8,-202)),this.createPlane(new i.Pa4(6e3,4,6e3),new i.Pa4(0,-60,0)),this.createBall(10,new i.Pa4(50,10,7),8421504,4),this.createBall(10,new i.Pa4(5,10,70),8421504,4),this.createBall(10,new i.Pa4(60,10,10),8421504,4)}darkenColor(t,e){const o=new i.Ilk(t),s={h:0,s:0,l:0};return o.getHSL(s),s.l=s.l*e,o.setHSL(s.h,s.s,s.l),o}createLeg(t,e,o,s,a=50){const r=new i.Tme,h=new i.xo$(s,a,a,0,2*Math.PI/3,0,Math.PI/2);h.rotateX(Math.PI),h.rotateY(4*Math.PI/3);const u=new i.Kj0(h,e);u.castShadow=!0,u.receiveShadow=!0,r.add(u);const d=new i.trn(s,a,0,2*Math.PI/3);d.rotateX(-Math.PI/2),d.rotateY(-Math.PI/3);const m=new i.Kj0(d,e);m.castShadow=!0,m.receiveShadow=!0,r.add(m);const p=new i.trn(s,a,0,Math.PI/2);p.rotateZ(-Math.PI/2),p.rotateY(-Math.PI/3);const l=new i.Kj0(p,e);l.castShadow=!0,l.receiveShadow=!0,r.add(l);const y=new i.trn(s,a,0,Math.PI/2);y.rotateY(-Math.PI/3),y.rotateX(Math.PI);const M=new i.Kj0(y,e);M.castShadow=!0,M.receiveShadow=!0,r.add(M),r.rotateY(2*Math.PI/3*o),t.add(r)}createHeadBop(t,e,o,s,a=50){const r=new i.xo$(s,a,a,0,2*Math.PI,0,Math.PI/6),h=new i.Kj0(r,e);h.castShadow=!0,h.receiveShadow=!0,t.add(h);const u=new i.xo$(s,a,a,0,2*Math.PI,Math.PI/6,Math.PI/6),d=new i.Kj0(u,o);d.castShadow=!0,d.receiveShadow=!0,t.add(d);const m=new i.xo$(s,a,a,2*Math.PI/3+Math.PI/12,2*Math.PI-Math.PI/6,Math.PI/3,Math.PI/6),p=new i.Kj0(m,e);p.castShadow=!0,p.receiveShadow=!0,t.add(p);const l=new i.xo$(s,a,a,2*Math.PI/3-Math.PI/12,Math.PI/6,Math.PI/3,Math.PI/6),y=new i.Kj0(l,o);y.castShadow=!0,y.receiveShadow=!0,t.add(y)}createPlayer(t=new i.Pa4(0,330,0)){const a=new i.Wid({metalness:.5,roughness:.5,color:9079434}),r=new i.YBo({color:0,emissive:this.darkenColor(65280,1)});this.player=new i.Tme,this.createHeadBop(this.player,a,r,20),this.createLeg(this.player,a,1,20,50),this.createLeg(this.player,a,2,20,50),this.createLeg(this.player,a,3,20,50),this.player.position.set(t.x,t.y,t.z),this.player.castShadow=!0,this.player.receiveShadow=!0,this.scene.add(this.player);const h=new this.Ammo.btTransform;h.setIdentity(),this.tmpVec.setValue(t.x,t.y,t.z),h.setOrigin(this.tmpVec),h.setRotation(new this.Ammo.btQuaternion(0,0,0,1));const u=new this.Ammo.btDefaultMotionState(h),d=new this.Ammo.btSphereShape(20);d.setMargin(.05),this.tmpVec.setValue(0,0,0);const m=this.tmpVec;d.calculateLocalInertia(100,m);const p=new this.Ammo.btRigidBodyConstructionInfo(100,u,d,m),l=new this.Ammo.btRigidBody(p);l.setFriction(this.friction),l.setRollingFriction(this.rollingFriction),l.setActivationState(w.DISABLE_DEACTIVATION),this.physicsWorld.addRigidBody(l,this.colGroupPlayer,this.colGroupPlane|this.colGroupBall),this.player.userData.physicsBody=l,this.player.userData.tag="player",this.player.userData.energy=14e3,this.player.userData.movement={},this.player.userData.movement={left:0,right:0,forward:0,back:0,up:0,isJumping:!1},l.threeObject=this.player,this.rigidBodies.push(this.player),this.visionLight.target=this.player}createPlane(t=new i.Pa4(400,4,400),e=new i.Pa4(0,0,0),o=8026746){const r=new i.Kj0(new i.nvb(1,1,1),new i.xoR({color:o}));r.position.set(e.x,e.y,e.z),r.scale.set(t.x,t.y,t.z),r.castShadow=!0,r.receiveShadow=!0,this.scene.add(r);const h=new this.Ammo.btTransform;h.setIdentity(),this.tmpVec.setValue(e.x,e.y,e.z),h.setOrigin(this.tmpVec),h.setRotation(new this.Ammo.btQuaternion(0,0,0,1));const u=new this.Ammo.btDefaultMotionState(h);this.tmpVec.setValue(.5*t.x,.5*t.y,.5*t.z);const d=new this.Ammo.btBoxShape(this.tmpVec);d.setMargin(.05),this.tmpVec.setValue(0,0,0);const m=this.tmpVec;d.calculateLocalInertia(0,m);const p=new this.Ammo.btRigidBodyConstructionInfo(0,u,d,m),l=new this.Ammo.btRigidBody(p);l.setFriction(this.friction),l.setRollingFriction(this.rollingFriction),l.setActivationState(w.DISABLE_DEACTIVATION),this.physicsWorld.addRigidBody(l,this.colGroupPlane,this.colGroupBall|this.colGroupPlayer),r.userData.physicsBody=l,r.userData.tag="plane",l.threeObject=r,this.rigidBodies.push(r)}createBall(t=2,e=new i.Pa4(0,20,0),o=8026746,s=1){const r=new i.Kj0(new i.Aip(t),new i.xoR({color:o}));r.position.set(e.x,e.y,e.z),r.castShadow=!0,r.receiveShadow=!0,this.scene.add(r);const h=new this.Ammo.btTransform;h.setIdentity(),this.tmpVec.setValue(e.x,e.y,e.z),h.setOrigin(this.tmpVec),h.setRotation(new this.Ammo.btQuaternion(0,0,0,1));const u=new this.Ammo.btDefaultMotionState(h),d=new this.Ammo.btSphereShape(t);d.setMargin(.05),this.tmpVec.setValue(0,0,0);const m=this.tmpVec;d.calculateLocalInertia(s,m);const p=new this.Ammo.btRigidBodyConstructionInfo(s,u,d,m),l=new this.Ammo.btRigidBody(p);l.setFriction(this.friction),l.setRollingFriction(this.rollingFriction),l.setActivationState(w.DISABLE_DEACTIVATION),this.physicsWorld.addRigidBody(l,this.colGroupBall,this.colGroupPlayer|this.colGroupPlane|this.colGroupBall),r.userData.physicsBody=l,r.userData.tag="ball",l.threeObject=r,this.rigidBodies.push(r)}createObstacle(t=2,e=100,o=new i.Pa4(0,20,0),s=8026746,a=0){const h=new i.Kj0(new i._3(t,e,20,20),new i.xoR({color:s}));h.position.set(o.x,o.y,o.z),h.castShadow=!0,h.receiveShadow=!0,this.scene.add(h);const u=new this.Ammo.btTransform;u.setIdentity(),this.tmpVec.setValue(o.x,o.y,o.z),u.setOrigin(this.tmpVec),u.setRotation(new this.Ammo.btQuaternion(0,0,0,1));const d=new this.Ammo.btDefaultMotionState(u),m=new this.Ammo.btConeShape(t,e);m.setMargin(.05),this.tmpVec.setValue(0,0,0);const p=this.tmpVec;m.calculateLocalInertia(a,p);const l=new this.Ammo.btRigidBodyConstructionInfo(a,d,m,p),y=new this.Ammo.btRigidBody(l);y.setFriction(this.friction),y.setRollingFriction(this.rollingFriction),y.setActivationState(w.DISABLE_DEACTIVATION),this.physicsWorld.addRigidBody(y,this.colGroupBall,this.colGroupPlayer|this.colGroupPlane),h.userData.physicsBody=y,h.userData.tag="ball",y.threeObject=h,this.rigidBodies.push(h)}movePlayer(){const t=this.player.userData.energy/1e4*100;this.tmpVec.setX(this.player.userData.physicsBody.getLinearVelocity().x()),this.tmpVec.setY(this.player.userData.physicsBody.getLinearVelocity().y()),this.tmpVec.setZ(this.player.userData.physicsBody.getLinearVelocity().z());const o=this.player.userData.movement.right-this.player.userData.movement.left,s=this.player.userData.movement.back-this.player.userData.movement.forward,a=this.player.userData.movement.up;0===Math.round(this.tmpVec.y())?a?(this.player.userData.movement.isJumping=!0,this.tmpVec.setY(400*a),this.player.userData.movement.up=0):this.player.userData.movement.isJumping=!1:this.player.userData.movement.isJumping=!0,0==o&&this.tmpVec.setX(0),0==s&&this.tmpVec.setZ(0),this.tmpVec.setX(o*t),this.tmpVec.setZ(s*t),this.player.userData.physicsBody.setLinearVelocity(this.tmpVec)}updatePhysics(t){this.physicsWorld.stepSimulation(t,10);for(let e=0;e<this.rigidBodies.length;e++){const o=this.rigidBodies[e],a=o.userData.physicsBody.getMotionState();if(a){a.getWorldTransform(this.tmpTrans);const r=this.tmpTrans.getOrigin(),h=this.tmpTrans.getRotation();o.position.set(r.x(),r.y(),r.z()),o.quaternion.set(h.x(),h.y(),h.z(),h.w())}}this.detectCollision()}detectCollision(){const t=this.physicsWorld.getDispatcher(),e=t.getNumManifolds();for(let o=0;o<e;o++){const s=t.getManifoldByIndexInternal(o),a=this.Ammo.castObject(s.getBody0(),D().btRigidBody),r=this.Ammo.castObject(s.getBody1(),D().btRigidBody),h=a.threeObject,u=r.threeObject;if(!h&&!u)continue;const d=h?h.userData:null,m=u?u.userData:null,l=m?m.tag:"none";if("plane"==(d?d.tag:"none")||"plane"==l)continue;const y=s.getNumContacts();for(let M=0;M<y;M++){const P=s.getContactPoint(M),S=P.getDistance();S>.01||S<-.01||(a.getLinearVelocity(),r.getLinearVelocity(),P.get_m_positionWorldOnA(),P.get_m_positionWorldOnB(),P.get_m_localPointA(),P.get_m_localPointB())}}}render(){this.camera.position.setX(this.player.position.x),this.camera.position.setY(this.player.position.y+2*this.cameraDistance),this.camera.position.setZ(this.player.position.z+this.cameraDistance),this.camera.lookAt(this.player.position),this.renderer.render(this.scene,this.camera)}resetPlayer(){this.player.userData.energy=2e4,this.relocate(this.player.userData.physicsBody,{x:0,y:10,z:0},{x:0,y:0,z:0})}relocate(t,e={x:0,y:0,z:0},o={x:0,y:0,z:0}){this.physicsWorld.removeRigidBody(t),this.tmpVec.setValue(0,0,0),this.player.userData.physicsBody.setLinearVelocity(this.tmpVec),this.player.userData.physicsBody.setAngularVelocity(this.tmpVec);const s=t.getWorldTransform();this.tmpVec.setValue(e.x,e.y,e.z);const a=new this.Ammo.btQuaternion(o.x,o.y,o.z,1);s.setOrigin(this.tmpVec),s.setRotation(a),t.setWorldTransform(s),this.physicsWorld.addRigidBody(t)}getCursorPosition(t){const e=new i.Pa4,o=new i.Pa4;e.set(t.clientX/window.innerWidth*2-1,-t.clientY/window.innerHeight*2+1,.5),e.unproject(this.camera),e.sub(this.camera.position).normalize();const s=-this.camera.position.y/e.y;return o.copy(this.camera.position).add(e.multiplyScalar(s)),o}onResize(){this.renderer.setSize(window.innerWidth,window.innerHeight),this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix()}onCursorMove(t){}onClick(t){"canvas"===t.path[0].localName&&(this.destinationPoint=this.getCursorPosition(t),console.log(this.destinationPoint))}onKeyDown(t){if(this.lastKey!==t.keyCode)switch(this.lastKey=t.keyCode,t.key){case"w":this.player.userData.movement.forward=1;break;case"s":this.player.userData.movement.back=1;break;case"a":this.player.userData.movement.left=1;break;case"d":this.player.userData.movement.right=1;break;case" ":this.player.userData.movement.up=1;break;case"Backspace":this.resetPlayer();break;case"0":this.soundService.muteTrack(),this.soundService.muteTrack(f.O.danger);break;case"1":this.soundService.toggleTrack(f.O.idle);break;case"2":this.soundService.toggleTrack(f.O.danger)}}onKeyUp(t){switch(this.lastKey=void 0,t.key){case"w":this.player.userData.movement.forward=0;break;case"s":this.player.userData.movement.back=0;break;case"a":this.player.userData.movement.left=0;break;case"d":this.player.userData.movement.right=0;break;case" ":this.player.userData.movement.up=0}}}return c.\u0275fac=function(t){return new(t||c)(n.Y36(f.y),n.Y36(V.k),n.Y36(n.SBq))},c.\u0275cmp=n.Xpm({type:c,selectors:[["smitd-main-menu"]],hostBindings:function(t,e){1&t&&n.NdJ("resize",function(s){return e.onResize(s)},!1,n.Jf7)("mousemove",function(s){return e.onCursorMove(s)},!1,n.Jf7)("mousedown",function(s){return e.onClick(s)},!1,n.Jf7)("keydown",function(s){return e.onKeyDown(s)},!1,n.evT)("keyup",function(s){return e.onKeyUp(s)},!1,n.evT)},decls:13,vars:8,consts:[[1,"hud"],["mat-raised-button","","smitd-click-sound","","color","primary",3,"routerLink"],["mat-raised-button","","smitd-click-sound","","color","warn",3,"click"]],template:function(t,e){1&t&&(n.TgZ(0,"div",0)(1,"p"),n._uU(2,"main-menu works!"),n.qZA(),n.TgZ(3,"button",1),n._uU(4,"Strategy"),n.qZA(),n.TgZ(5,"button",1),n._uU(6,"AdamLonger"),n.qZA(),n.TgZ(7,"button",1),n._uU(8,"Caspien"),n.qZA(),n.TgZ(9,"button",1),n._uU(10,"Catchy"),n.qZA(),n.TgZ(11,"button",2),n.NdJ("click",function(){return e.fight()}),n._uU(12,"Fight"),n.qZA()()),2&t&&(n.xp6(3),n.Q6J("routerLink",n.DdM(4,x)),n.xp6(2),n.Q6J("routerLink",n.DdM(5,k)),n.xp6(2),n.Q6J("routerLink",n.DdM(6,T)),n.xp6(2),n.Q6J("routerLink",n.DdM(7,z)))},directives:[C.lW,L.O,I.rH],styles:[".hud[_ngcontent-%COMP%]{position:fixed;z-index:1}"]}),c})()}];let O=(()=>{class c{}return c.\u0275fac=function(t){return new(t||c)},c.\u0275mod=n.oAB({type:c}),c.\u0275inj=n.cJS({imports:[[I.Bz.forChild(R)],I.Bz]}),c})();var j=g(3226);let G=(()=>{class c{}return c.\u0275fac=function(t){return new(t||c)},c.\u0275mod=n.oAB({type:c}),c.\u0275inj=n.cJS({imports:[[A.ez,O,j.m]]}),c})()}}]);